

<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 5 页 | 帅羊羊的博客</title>
  
  <meta name="google-site-verification" content="hLu-CnRbqpthWxa76MJ-vpnGr7yMChNtTW6KA0pRMQo" />  
  <meta name="baidu-site-verification" content="SOcrumVYOq" />  
  
  
  <meta name="author" content="Shuai yy">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="帅羊羊的博客"/>

  
    <meta property="og:image" content=""/>
  
  <link href="/favicon.ico" rel="icon" type="image/x-ico">
  <link rel="alternate" href="http://shuaiyy.cn/atom.xml" title="帅羊羊的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//libs.baidu.com/jquery/1.8.0/jquery.min.js"></script>
  
  
</head>



<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">帅羊羊的博客</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
	  
    
      <li><a href="/archives"><i class="fa fa-archive"></i>归档</a></li>
	  
    
      <li><a href="/resume"><i class="fa fa-user"></i>关于</a></li>
	  
    
      <li><a href="/books"><i class="fa fa-book"></i>阅读</a></li>
	  
    
      <li><a href="/movies"><i class="fa fa-play-circle"></i>电影</a></li>
	  
    
	<li> <a href="/atom.xml"><i class="fa fa-rss"></i>RSS</a> </li>
<li> <a title="把这个链接拖到你的Chrome收藏夹工具栏中" href='javascript:(function() {
	function c() {
		var e = document.createElement("link");
		e.setAttribute("type", "text/css");
		e.setAttribute("rel", "stylesheet");
		e.setAttribute("href", f);
		e.setAttribute("class", l);
		document.body.appendChild(e)
	}
 
	function h() {
		var e = document.getElementsByClassName(l);
		for (var t = 0; t < e.length; t++) {
			document.body.removeChild(e[t])
		}
	}
 
	function p() {
		var e = document.createElement("div");
		e.setAttribute("class", a);
		document.body.appendChild(e);
		setTimeout(function() {
			document.body.removeChild(e)
		}, 100)
	}
 
	function d(e) {
		return {
			height : e.offsetHeight,
			width : e.offsetWidth
		}
	}
 
	function v(i) {
		var s = d(i);
		return s.height > e && s.height < n && s.width > t && s.width < r
	}
 
	function m(e) {
		var t = e;
		var n = 0;
		while (!!t) {
			n += t.offsetTop;
			t = t.offsetParent
		}
		return n
	}
 
	function g() {
		var e = document.documentElement;
		if (!!window.innerWidth) {
			return window.innerHeight
		} else if (e && !isNaN(e.clientHeight)) {
			return e.clientHeight
		}
		return 0
	}
 
	function y() {
		if (window.pageYOffset) {
			return window.pageYOffset
		}
		return Math.max(document.documentElement.scrollTop, document.body.scrollTop)
	}
 
	function E(e) {
		var t = m(e);
		return t >= w && t <= b + w
	}
 
	function S() {
		var e = document.createElement("audio");
		e.setAttribute("class", l);
		e.src = i;
		e.loop = false;
		e.addEventListener("canplay", function() {
			setTimeout(function() {
				x(k)
			}, 500);
			setTimeout(function() {
				N();
				p();
				for (var e = 0; e < O.length; e++) {
					T(O[e])
				}
			}, 15500)
		}, true);
		e.addEventListener("ended", function() {
			N();
			h()
		}, true);
		e.innerHTML = " <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>";
		document.body.appendChild(e);
		e.play()
	}
 
	function x(e) {
		e.className += " " + s + " " + o
	}
 
	function T(e) {
		e.className += " " + s + " " + u[Math.floor(Math.random() * u.length)]
	}
 
	function N() {
		var e = document.getElementsByClassName(s);
		var t = new RegExp("\\b" + s + "\\b");
		for (var n = 0; n < e.length; ) {
			e[n].className = e[n].className.replace(t, "")
		}
	}
 
	var e = 30;
	var t = 30;
	var n = 350;
	var r = 350;
	var i = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake.mp3";
	var s = "mw-harlem_shake_me";
	var o = "im_first";
	var u = ["im_drunk", "im_baked", "im_trippin", "im_blown"];
	var a = "mw-strobe_light";
	var f = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake-style.css";
	var l = "mw_added_css";
	var b = g();
	var w = y();
	var C = document.getElementsByTagName("*");
	var k = null;
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			if (E(A)) {
				k = A;
				break
			}
		}
	}
	if (A === null) {
		console.warn("Could not find a node of the right size. Please try a different page.");
		return
	}
	c();
	S();
	var O = [];
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			O.push(A)
		}
	}
})()    '>High一下</a> </li>

  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-12-12T16:00:00.000Z"><a href="/2016/12/13/技术/HTML-basic-grammar/">2016-12-13</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/12/13/技术/HTML-basic-grammar/">HTML语法基础</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML语法基础"><span class="toc-text">HTML语法基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语法"><span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML基本结构"><span class="toc-text">HTML基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#格式标记"><span class="toc-text">格式标记</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文本标记"><span class="toc-text">文本标记</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图像标签"><span class="toc-text">图像标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#超链接"><span class="toc-text">超链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML表格"><span class="toc-text">HTML表格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML表单"><span class="toc-text">HTML表单</span></a></li></ol></li></ol>
    </div>

      
        <h2 id="HTML语法基础"><a href="#HTML语法基础" class="headerlink" title="HTML语法基础"></a>HTML语法基础</h2><blockquote>
<p>学习django的时候发现还是要懂点html语法的</p>
</blockquote>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul>
<li><p>html是一种展示网页的标记语言</p>
</li>
<li><p>由标签和被其标记的内容组成，标签的属性控制着显示的方式</p>
<p><code>&lt;tag key=&quot;value&quot;&gt;被标记的内容&lt;/tag&gt;</code></p>
</li>
<li><p>语法不区分大小写，默认使用小写</p>
</li>
<li><p>语法不区分回车、空格和缩进，为了代码可读和逻辑清晰，应该保持严格的缩进风格，必要时添加注释</p>
</li>
<li><p>注释内容<code>&lt;!-- XXXXX --!&gt;</code>，不会被显示</p>
</li>
<li><p>字符字体：保留字符无法直接使用，如<code>&lt;</code> <code>&gt;</code> 会和标签符号产生歧义，可以使用&amp;lt 或 &amp;#60表示小于号</p>
<p><img src="http://ww1.sinaimg.cn/large/af9df239gw1fap52sfmasj20k00f1wff.jpg" alt="HTML字符字体"></p>
</li>
</ul>
<h3 id="HTML基本结构"><a href="#HTML基本结构" class="headerlink" title="HTML基本结构"></a>HTML基本结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--html标签是文档开始和结束的标志--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--HTML文件头标记，用来包含文件的基本信息，比如网页的标题、关键字，在 可以放&lt;title&gt;&lt;/title&gt;、&lt;meta&gt;&lt;/meta&gt;、&lt;style&gt;&lt;/style&gt;等等标记--&gt;</span></div><div class="line">    <span class="comment">&lt;!--注意:在&lt;head&gt;&lt;/head&gt;标记内的内容不会在浏览器中显示--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--&lt;meta&gt; 元素可提供有关某个 HTML 元素的元信息 (meta-information)，比如描述、针对搜索引擎的关键词以及刷新频率。--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>这是网页的标题<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--网页的“主题”，显示在浏览器的标题栏，网页的标题不能太长，要短小精悍，能具体反应页面的内容，&lt;title&gt;&lt;/title&gt;标记中不能包含其他标记--&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--HTML文档的主体标记--&gt;</span></div><div class="line"><span class="comment">&lt;!--功能：&lt;body&gt;...&lt;/body&gt;是网页的主体部分，在此标记之间可以包含如&lt;p&gt;&lt;/p&gt;、&lt;h1&gt;&lt;/h1&gt;、&lt;br&gt;、&lt;hr&gt;等等标记，这些内容组成了我们所看见的网页--&gt;</span></div><div class="line"><span class="comment">&lt;!--body的属性有：背景颜色 bgcolor="red",文本颜色text="green",链接颜色 link="blue"，--&gt;</span></div><div class="line"><span class="comment">&lt;!--              已访问过链接的颜色vlink="yellow",正在被点击连接的颜色 alink="red"--&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="格式标记"><a href="#格式标记" class="headerlink" title="格式标记"></a>格式标记</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;br&gt;  		            强制换行，后面的内容会显示在下一行</div><div class="line">&lt;p&gt;...&lt;/p&gt;  	        段落标记</div><div class="line">&lt;center&gt;...&lt;/center&gt;	居中对齐标记：让段落或者是文字相对于父标记居中显示</div><div class="line">&lt;pre&gt;...&lt;/pre&gt;			预格式化标记：保留预先编排好的格式</div><div class="line">&lt;li&gt;第一个&lt;/li&gt;		  列表项目,默认无序</div><div class="line">&lt;ul&gt;...&lt;/ul&gt;			声明无序列表，内嵌套&lt;li&gt;</div><div class="line">&lt;ol&gt;...&lt;/ol&gt;		声明列表有序内嵌套&lt;li&gt;,属性type=&quot;[1|A|a|I|i]&quot; value=&quot;序列起始值&quot;</div><div class="line">&lt;dl&gt; &lt;dt&gt; &lt;dd&gt;		定义性列表，对列表条目进行简短的说明</div><div class="line">&lt;hr&gt;				水平分割线</div><div class="line">&lt;div&gt;...&lt;/div&gt;		 分区显示/层标记，可以多层嵌套，用来编排一大段HTML代码</div></pre></td></tr></table></figure>
<h3 id="文本标记"><a href="#文本标记" class="headerlink" title="文本标记"></a>文本标记</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;...&lt;/h1&gt; h1~6				1级标题文本最大，6级标题文本最小</div><div class="line">&lt;font size=&apos;3&apos; color=&apos;green&apos; face=&quot;微软雅黑&quot;&gt;有字体格式的文字&lt;/font&gt;</div><div class="line">&lt;b&gt;粗体字&lt;/b&gt;</div><div class="line">&lt;i&gt;斜体字&lt;/i&gt;</div><div class="line">&lt;sub&gt;下标字体&lt;/sub&gt;</div><div class="line">&lt;sup&gt;上标字体&lt;/sup&gt;</div><div class="line">&lt;tt&gt;打印机字体&lt;/tt&gt;</div><div class="line">&lt;cite&gt;引用方式的字体，通常是斜体&lt;/cite&gt;</div><div class="line">&lt;em&gt;强调字体，通常是斜体&lt;/em&gt;</div><div class="line">&lt;strong&gt;强调字体，通常是粗体&lt;/strong&gt;</div><div class="line">&lt;small&gt;小型字体&lt;/small&gt;</div><div class="line">&lt;big&gt;大型字体&lt;/big&gt;</div><div class="line">&lt;u&gt;带下划线的字&lt;/u&gt;</div></pre></td></tr></table></figure>
<h3 id="图像标签"><a href="#图像标签" class="headerlink" title="图像标签"></a>图像标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;img src=&quot;路径/文件名.图片格式&quot; width=&quot;属性值&quot; height=&quot;属性值&quot; border=&quot;属性值&quot; alt=&quot;属性值&quot;&gt;</div><div class="line">属性：		  作用</div><div class="line">src			指定加载文件的路径</div><div class="line">width		指定图片的宽度，单位px、em、cm、mm</div><div class="line">height		指定图片的高度，单位px、em、cm、mm</div><div class="line">border		指定图标的边框宽度，单位px、em、cm、mm</div><div class="line">alt			当网页上的图片被加载完成后，鼠标移动到上面去，会显示这个图片指定的属性文字</div><div class="line">			如果图像没有下载或者加载失败，会用文字来代替图像显示</div><div class="line">			搜索引擎可以通过这个属性的文字来抓取图片</div></pre></td></tr></table></figure>
<h3 id="超链接"><a href="#超链接" class="headerlink" title="超链接"></a>超链接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;a href=&quot;&quot; target=&quot;打开方式&quot; name=&quot;页面锚点名称&quot; &gt;链接文字或者图片&lt;/a&gt;</div><div class="line">href		链接的地址，可以是网页或视频、图片、音乐等等</div><div class="line">target		定义超链接的打开方式</div><div class="line">target取值</div><div class="line">			_blank:在一个新的窗口中打开链接</div><div class="line">			_seif(默认值):在当前窗口中打开链接</div><div class="line">			_parent:在父窗口中打开页面（框架中使用较多）</div><div class="line">			_top:在顶层窗口中打开文件（框架中使用较多）</div><div class="line">name		指定页面的锚点名称</div><div class="line">使用a标签实现页内跳转</div><div class="line">&lt;a href=&quot;#id1&quot;&gt;点击后跳到本页id值为id1的tag位置&lt;/a&gt;</div></pre></td></tr></table></figure>
<h3 id="HTML表格"><a href="#HTML表格" class="headerlink" title="HTML表格"></a>HTML表格</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">table</span>  <span class="attr">width</span>=<span class="string">"80%"</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">height</span>=<span class="string">"100"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- width 和 height的值可以是px或父级的%值， border是表格外框的宽度，默认值是0； align是表格的显示位置，left默认，right，center--&gt;</span></div><div class="line">    <span class="comment">&lt;!-- cellspacing，单元格之间的间距，默认是2px；cellpadding 单元格内容与单元格边框的显示距离，单位像素 --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- frame 控制表格边框最外层的四条线框；rules 控制是否显示以及如何显示单元格之间的分割线；--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">caption</span> <span class="attr">align</span>=<span class="string">"bottom"</span>&gt;</span>表格的标题<span class="tag">&lt;/<span class="name">caption</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--caption位于table之后，tr表格行之前,其align属性取值 top、bottom、left、right，指定标题的位置--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 对于每一个表格行，都是由一对&lt;tr&gt;...&lt;/tr&gt;标记表示，每一行&lt;tr&gt;标记内可以嵌套多个&lt;td&gt;或者&lt;th&gt;标记 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>班级<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--td 和th标签，必须在tr内，th是表头的单元格标记，即表格的首行 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>成绩<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>四年级一班<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--td 表格的数据单元格标记--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>16<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>80<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><img src="http://ww3.sinaimg.cn/large/af9df239gw1fap9268ogfj20pr03tglo.jpg" alt="html 表格"></p>
<h3 id="HTML表单"><a href="#HTML表单" class="headerlink" title="HTML表单"></a>HTML表单</h3><ul>
<li>form表单</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"."</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">name</span>=<span class="string">"login"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--&lt;form action="服务器端地址（接受表单内容的地址）" name="表单名称" method="post|get"&gt;...&lt;/form&gt;--&gt;</span></div><div class="line">        <span class="comment">&lt;!--get方式提交时，会将表单的内容附加在URL地址的后面，所以限制了提交的内容的长度，不超过8192个字符，且不具备保密性--&gt;</span></div><div class="line">        <span class="comment">&lt;!--post方式提交时，将表单中的数据一并包含在表单主体中，一起传送到服务器中处理，没有数据大小限制--&gt;</span></div><div class="line">        <span class="comment">&lt;!-- action=表单数据的处理程序的URL地址,为空则使用当前文档的URL地址，如果不需要使用,action="no"--&gt;</span></div><div class="line">        <span class="comment">&lt;!-- enctype,设置表单的资料的编码方式; target,和超链接的属于类似，用来指定目标窗口--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"login_name"</span> <span class="attr">value</span>=<span class="string">"QQ or Email"</span> <span class="attr">maxlength</span>=<span class="string">"20"</span> <span class="attr">size</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"login_passwd"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">size</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">checked</span>=<span class="string">"checked"</span>&gt;</span>男<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">value</span>=<span class="string">"隐藏的内容"</span> <span class="attr">name</span>=<span class="string">"mihiddenma"</span> <span class="attr">size</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>爱好：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"tiyu"</span> <span class="attr">checked</span>=<span class="string">"checked"</span>&gt;</span>体育<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"changge"</span>&gt;</span>唱歌<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">            地址：</div><div class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"dizhi"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"sichuan"</span>&gt;</span>四川<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"beijing"</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"shanghai"</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>自我介绍 <span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"35"</span> <span class="attr">rows</span>=<span class="string">"10"</span> <span class="attr">name</span>=<span class="string">"自我介绍"</span>&gt;</span>介绍一下你自己呗！<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交注册"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">value</span>=<span class="string">"重置"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"一个按钮"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li><p>input标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1、文本域/密码框： &lt;input type=&quot;text/password&quot; name=&quot;&quot; value=&quot;框内初始化值&quot; size=&quot;框长&quot; maxlength=&quot;最大字符数&quot;&gt;</div><div class="line">2、提交，重置和普通按钮 &lt;input type=&quot;submit/reser/button&quot;&gt;</div><div class="line">3、单选框和复选框 &lt;input type=&quot;radio/checkbox&quot; checked=&quot;checked&quot;&gt; checked=&quot;checked&quot; 会默认该项被选中</div><div class="line">4、隐藏域 &lt;input type=&quot;hidden&quot; value=&quot;&quot; name=&quot;&quot;&gt; 一般用来提交验证信息</div><div class="line">5 多行文本 &lt;textarea name=&quot;name&quot; rows=&quot;value&quot; cols=&quot;value&quot; value=&quot;value&quot;&gt; ... ... &lt;/textarea&gt; rows和 cols指定行数和列数</div><div class="line">6、下拉菜单</div><div class="line">&lt;select name=&quot;&quot; size=&quot;列表高度&quot; multiple&gt;  ### 如果使用mutiple关键字，则是一个下拉列表，不使用时是下拉框</div><div class="line">	&lt;option value=&quot;value&quot; selected&gt;选项1&lt;/option&gt;  ### 指定了selected关键字是默认选中项，value的值是要发送给服务器上的数据</div><div class="line">	&lt;option value=&quot;value&quot;&gt;选项2&lt;/option&gt;</div><div class="line">	&lt;option value=&quot;value&quot;&gt;选项3&lt;/option&gt;</div><div class="line">&lt;/select&gt;</div></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/af9df239gw1fapaeowvxfj208o0dy3yk.jpg" alt="表单效果"></p>
</li>
</ul>

      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-11-30T16:00:00.000Z"><a href="/2016/12/01/技术/mongodb 使用技巧/">2016-12-01</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/12/01/技术/mongodb 使用技巧/">Mongodb 学习笔记</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ubuntu安装，mongodb"><span class="toc-text">ubuntu安装，mongodb</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mongodb-使用技巧"><span class="toc-text">mongodb 使用技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#find"><span class="toc-text">find</span></a></li></ol>
    </div>

      
        <h3 id="ubuntu安装，mongodb"><a href="#ubuntu安装，mongodb" class="headerlink" title="ubuntu安装，mongodb"></a>ubuntu安装，mongodb</h3><ul>
<li><p><code>apt-get install mongodb</code></p>
<p>安装好之后，服务自动运行，<code>service mongodb stop</code>停止服务，找到数据库存储位置<code>/var/lib/mongodb/</code>和日志文件位置<code>/var/log/mongodb/mongodb.log</code>,然后手动运行服务<code>mongod --dbpath /var/lib/mongodb/ --logpath /var/log/mongodb/mongodb.log --logappend &amp;</code></p>
</li>
<li><p>如果想作为服务一直运行</p>
<p>修改<code>/etc/mongodb.conf</code>参数，允许远程登录和身份认证，</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mongodb.conf</span></div><div class="line"><span class="comment"># Where to store the data.</span></div><div class="line"><span class="attr">dbpath</span>=/var/lib/mongodb</div><div class="line"><span class="comment">#where to log</span></div><div class="line"><span class="attr">logpath</span>=/var/log/mongodb/mongodb.log</div><div class="line"><span class="attr">logappend</span>=<span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># 允许远程注释掉此处</span></div><div class="line"><span class="attr">bind_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></div><div class="line"><span class="comment"># 修改端口在此处</span></div><div class="line"><span class="attr">port</span> = <span class="number">27017</span></div><div class="line"></div><div class="line"><span class="comment"># Enable journaling, http://www.mongodb.org/display/DOCS/Journaling</span></div><div class="line"><span class="attr">journal</span>=<span class="literal">true</span></div><div class="line"><span class="comment"># 默认是关闭认证的，开启账号密码认证改此处</span></div><div class="line"><span class="comment"># Turn on/off security.  Off is currently the default</span></div><div class="line"><span class="comment">#noauth = true</span></div><div class="line"><span class="attr">auth</span> = <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># Verbose logging output.</span></div><div class="line"><span class="attr">verbose</span> = <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>然后运行服务<code>service mongodb restart</code>，本地连接mongodb后，给某个数据库添加用户，然后重启service。给admin添加的用户有数据库管理员权限。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">MongoDB shell version: 2.4.9</div><div class="line">connecting to: test</div><div class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></div><div class="line">admin	(empty)</div><div class="line">local	0.078125GB</div><div class="line"><span class="meta">&gt;</span><span class="bash"> use admin</span></div><div class="line">switched to db admin</div><div class="line"><span class="meta">&gt;</span><span class="bash"> db.addUser(<span class="string">'mongo'</span>,<span class="string">'mongo123'</span>)</span></div><div class="line">&#123;</div><div class="line">	"user" : "mongo",</div><div class="line">	"readOnly" : false,</div><div class="line">	"pwd" : "6a524e081c761e95c4d0b0096840d87c",</div><div class="line">	"_id" : ObjectId("591078d7a129373b2f059bb3")</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>连接mongodb</p>
<ol>
<li><p>指定数据库及身份信息 <code>mongo ip/dbname -u username -p password</code></p>
</li>
<li><p>先连接，后认证</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mongo  ip</div><div class="line">use dbname</div><div class="line">db.auth('username', 'password')</div></pre></td></tr></table></figure>
</li>
<li><p>URI <code>MONGO_URI = &#39;mongodb://localhost:27017&#39;</code> <code>MONGO_URI = &#39;mongodb://user:pass@localhost:27017&#39;</code></p>
</li>
</ol>
</li>
</ul>
<h2 id="mongodb-使用技巧"><a href="#mongodb-使用技巧" class="headerlink" title="mongodb 使用技巧"></a>mongodb 使用技巧</h2><blockquote>
<p>pymongo api</p>
</blockquote>
<h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><ul>
<li><p>查询非空</p>
<p><code>db.mycollection.find({&quot;pic_url&quot;:{$ne:null}});</code></p>
</li>
<li><p>查询某个key的值</p>
<p><code>db.mycollection.find({&quot;IMAGE URL&quot;:{$ne:&#39;&#39;}});</code></p>
</li>
<li><p>​</p>
<p>​</p>
</li>
</ul>

      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-11-15T16:00:00.000Z"><a href="/2016/11/16/技术/python-cookbook-note1/">2016-11-16</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/11/16/技术/python-cookbook-note1/">Python cookbook 笔记1</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据结构和算法"><span class="toc-text">数据结构和算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串和文本"><span class="toc-text">字符串和文本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#日期和时间"><span class="toc-text">日期和时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#迭代器和生成器"><span class="toc-text">迭代器和生成器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件和IO"><span class="toc-text">文件和IO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据编码和处理"><span class="toc-text">数据编码和处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数"><span class="toc-text">函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类和对象"><span class="toc-text">类和对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#元编程"><span class="toc-text">元编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块和包"><span class="toc-text">模块和包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#网络和web编程"><span class="toc-text">网络和web编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#并发编程"><span class="toc-text">并发编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#脚本和系统管理"><span class="toc-text">脚本和系统管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异常、调试、测试"><span class="toc-text">异常、调试、测试</span></a></li></ol>
    </div>

      
        <h3 id="数据结构和算法"><a href="#数据结构和算法" class="headerlink" title="数据结构和算法"></a>数据结构和算法</h3><ul>
<li>多变量同时赋值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"># 左右两边必须数目一致，右边为列表或任意可迭代对象</div><div class="line">l = [&apos;a&apos;, 1, 345]</div><div class="line">a, b, c = l</div><div class="line">print(a, b, c)</div><div class="line">a, b, c = &apos;qwe&apos;</div><div class="line">print(a, b, c)</div><div class="line"># 变量数小于赋值数，使用*args表达式</div><div class="line">a, *others1 = l</div><div class="line">*others2, b = l</div><div class="line">print(a, b, others1, others2) #others是列表类型</div><div class="line"># 处理字符串分割时，或变长元组的序列时，使用*args变量来占位，很方便</div><div class="line">line = &apos;nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false&apos;</div><div class="line">uname, *fields, homedir, sh = line.split(&apos;:&apos;)</div><div class="line">records = [</div><div class="line">(&apos;foo&apos;, 1, 2),</div><div class="line">(&apos;bar&apos;, &apos;hello&apos;),</div><div class="line">(&apos;foo&apos;, 3, 4),</div><div class="line">(&apos;a&apos;, 4, 5, 6),</div><div class="line">]</div><div class="line"></div><div class="line">for tag, *args in records:</div><div class="line">if tag == &apos;foo&apos;:</div></pre></td></tr></table></figure>
<ul>
<li>保存一个迭代对象的最后N个元素<br>使用大小为N的队列实现，队列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">from collections import deque</div><div class="line">q = deque(maxlen=3)</div><div class="line">q.append(1)</div><div class="line">q.appendleft(0)</div><div class="line">q.pop()</div><div class="line">q.popleft()</div></pre></td></tr></table></figure>
<ul>
<li>获得最大或最小的N个元素</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">heapq模块有两个函数：nlargest()和nsmallest()可以完美解决这个问题。</div><div class="line">import heapq</div><div class="line">nums = [1, 8, 2, 23, 7, -4, 18, 23, 42, 37, 2]</div><div class="line">print(heapq.nlargest(3, nums)) # Prints [42, 37, 23]</div><div class="line">print(heapq.nsmallest(3, nums)) # Prints [-4, 1, 2]</div><div class="line">两个函数都能接受一个关键字参数，用于更复杂的数据结构中：</div><div class="line">portfolio = [</div><div class="line">&#123;&apos;name&apos;: &apos;IBM&apos;, &apos;shares&apos;: 100, &apos;price&apos;: 91.1&#125;,</div><div class="line">&#123;&apos;name&apos;: &apos;AAPL&apos;, &apos;shares&apos;: 50, &apos;price&apos;: 543.22&#125;,</div><div class="line">&#123;&apos;name&apos;: &apos;FB&apos;, &apos;shares&apos;: 200, &apos;price&apos;: 21.09&#125;,</div><div class="line">&#123;&apos;name&apos;: &apos;HPQ&apos;, &apos;shares&apos;: 35, &apos;price&apos;: 31.75&#125;,</div><div class="line">&#123;&apos;name&apos;: &apos;YHOO&apos;, &apos;shares&apos;: 45, &apos;price&apos;: 16.35&#125;,</div><div class="line">&#123;&apos;name&apos;: &apos;ACME&apos;, &apos;shares&apos;: 75, &apos;price&apos;: 115.65&#125;</div><div class="line">]</div><div class="line">cheap = heapq.nsmallest(3, portfolio, key=lambda s: s[&apos;price&apos;])</div><div class="line">expensive = heapq.nlargest(3, portfolio, key=lambda s: s[&apos;price&apos;])</div><div class="line">译者注：上面代码在对每个元素进行对比的时候，会以price的值进行比较。</div><div class="line">heapq.heapify(nums) //生成堆</div></pre></td></tr></table></figure>
<ul>
<li>字典一个键映射多个值<br>将字典对应的多个值放到列表或集合里,集合元素是无序且不重复的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">from collections import defaultdict</div><div class="line">d = defaultdict(list)</div><div class="line">d[&apos;a&apos;].append(1)</div><div class="line">d[&apos;a&apos;].append(2)</div><div class="line">d[&apos;b&apos;].append(4)</div><div class="line">d = defaultdict(set)</div><div class="line">d[&apos;a&apos;].add(1)</div><div class="line">d[&apos;a&apos;].add(2)</div><div class="line">d[&apos;b&apos;].add(4)</div></pre></td></tr></table></figure>
<ul>
<li>有序字典<br>在迭代或序列化时，希望字典是有序的，有序dict是普通dict内存的2倍</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">from collections import OrderedDict</div><div class="line">def ordered_dict():</div><div class="line">d = OrderedDict()</div><div class="line">d[&apos;foo&apos;] = 1</div><div class="line">d[&apos;bar&apos;] = 2</div><div class="line">d[&apos;spam&apos;] = 3</div><div class="line">d[&apos;grok&apos;] = 4</div><div class="line"># Outputs &quot;foo 1&quot;, &quot;bar 2&quot;, &quot;spam 3&quot;, &quot;grok 4&quot;</div><div class="line">for key in d:</div><div class="line">print(key, d[key])</div><div class="line"># 输出有序的json编码</div><div class="line">&gt;&gt;&gt; import json</div><div class="line">&gt;&gt;&gt; json.dumps(d)</div><div class="line">&apos;&#123;&quot;foo&quot;: 1, &quot;bar&quot;: 2, &quot;spam&quot;: 3, &quot;grok&quot;: 4&#125;&apos;</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>
<ul>
<li>字典运算<br>查找最大值和最小值，zip函数，将dict的值和value转置，直接使用max，min处理dict，计算的值是dict的key，得到的结果也是key。也可以配合sort</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">prices = &#123;</div><div class="line">&apos;ACME&apos;: 45.23,</div><div class="line">&apos;AAPL&apos;: 612.78,</div><div class="line">&apos;IBM&apos;: 205.55,</div><div class="line">&apos;HPQ&apos;: 37.20,</div><div class="line">&apos;FB&apos;: 10.75, &apos;qw&apos;: 10.75</div><div class="line">&#125;</div><div class="line">b = zip(prices.values(), prices.keys())</div><div class="line">for i in b:</div><div class="line">    print(i)</div><div class="line">//b是一个只能迭代一次的对象</div><div class="line">(205.55, &apos;IBM&apos;)</div><div class="line">(10.75, &apos;qw&apos;)</div><div class="line">(10.75, &apos;FB&apos;)</div><div class="line">(45.23, &apos;ACME&apos;)</div><div class="line">(612.78, &apos;AAPL&apos;)</div><div class="line">(37.2, &apos;HPQ&apos;)</div><div class="line">b = zip(prices.values(), prices.keys())</div><div class="line">print(min(b)) //如果有多个相同值的key存在，会再根据key的大小返回结果</div><div class="line">(10.75, &apos;FB&apos;)</div></pre></td></tr></table></figure>
<ul>
<li>寻找2个字典的相同之处</li>
</ul>
<p>集合操作，&amp; - +</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">a = &#123;</div><div class="line">&apos;x&apos; : 1,</div><div class="line">&apos;y&apos; : 2,</div><div class="line">&apos;z&apos; : 3</div><div class="line">&#125;</div><div class="line">b = &#123;</div><div class="line">&apos;w&apos; : 10,</div><div class="line">&apos;x&apos; : 11,</div><div class="line">&apos;y&apos; : 2</div><div class="line">&#125;</div><div class="line"></div><div class="line">print(a.keys() &amp; b.keys())</div><div class="line">&#123;&apos;y&apos;, &apos;x&apos;&#125;</div><div class="line">print(a.items() &amp; b.items())</div><div class="line">&#123;(&apos;y&apos;, 2)&#125;</div><div class="line">print(a.items() - b.items())</div><div class="line">&#123;(&apos;z&apos;, 3), (&apos;x&apos;, 1)&#125;</div><div class="line">print(a.items() | b.items())</div><div class="line">&#123;(&apos;y&apos;, 2), (&apos;w&apos;, 10), (&apos;z&apos;, 3), (&apos;x&apos;, 11), (&apos;x&apos;, 1)&#125;</div><div class="line"># dict.values()不支持集合操作，因为不能保证值无重复，可以先转为set。</div><div class="line"># 排除字典里某些元素，构建新的字典</div><div class="line">c = &#123;key:a[key] for key in a.keys() - &#123;&apos;z&apos;, &apos;w&apos;&#125;&#125;</div></pre></td></tr></table></figure>
<ul>
<li>保持序列原有的序列顺序，同时删除重复的值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># 利用集合或者生成器，直接使用set会打乱原有顺序</div><div class="line">def dedupe(items):</div><div class="line">	seen = set()</div><div class="line">	for item in items:</div><div class="line">		if item not in seen:</div><div class="line">			yield item</div><div class="line">			seen.add(item)</div><div class="line">a = [1, 5, 2, 1, 9, 1, 5, 10]</div><div class="line">print(list(deque(a)))</div><div class="line"># 用来去除文件里重复的行也可以</div><div class="line">with open(&apos;a.txt&apos;) as f:</div><div class="line">    for line in deque(f):</div><div class="line">        print(line)</div></pre></td></tr></table></figure>
<ul>
<li>命名切片</li>
</ul>
<p>使用可读的变量名定义slice对象，增加代码可维护可读性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">record = &apos;....................100 .......513.25 ..........&apos;</div><div class="line"># s.start, s.stop, s.step 分片对象属性，s.indices(len(record)),根据record长度重新映射分片的边界</div><div class="line">PRICE = slice(31,37)</div><div class="line">NUMBERS = slice(20,23)</div><div class="line">cost = int(record[NUMBERS]) * float(record[PRICE])</div></pre></td></tr></table></figure>
<ul>
<li>统计序列中元素出现的次数</li>
</ul>
<p>常规方法我们会用字典计数实现，key保存元素，value用来计数，<code>count[&#39;s&#39;] += 1</code> 。<br>collections.Counter类更方便，还有most_common方法,更重要的是两个counter对象实例可以进行数学运算+，-</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">words = [</div><div class="line">&apos;look&apos;, &apos;into&apos;, &apos;my&apos;, &apos;eyes&apos;, &apos;look&apos;, &apos;into&apos;, &apos;my&apos;, &apos;eyes&apos;,</div><div class="line">&apos;the&apos;, &apos;eyes&apos;, &apos;the&apos;, &apos;eyes&apos;, &apos;the&apos;, &apos;eyes&apos;, &apos;not&apos;, &apos;around&apos;, &apos;the&apos;,</div><div class="line">&apos;eyes&apos;, &quot;don&apos;t&quot;, &apos;look&apos;, &apos;around&apos;, &apos;the&apos;, &apos;eyes&apos;, &apos;look&apos;, &apos;into&apos;,</div><div class="line">&apos;my&apos;, &apos;eyes&apos;, &quot;you&apos;re&quot;, &apos;under&apos;</div><div class="line">]</div><div class="line">from collections import Counter</div><div class="line">word_counts = Counter(words)</div><div class="line"># 出现频率最高的3 个单词</div><div class="line">top_three = word_counts.most_common(3)</div><div class="line">print(top_three)</div><div class="line"># Outputs [(&apos;eyes&apos;, 8), (&apos;the&apos;, 5), (&apos;look&apos;, 4)]</div><div class="line">print(word_counts)</div><div class="line">Counter(&#123;&apos;eyes&apos;: 8, &apos;the&apos;: 5, &apos;look&apos;: 4, &apos;my&apos;: 3, &apos;into&apos;: 3, &apos;around&apos;: 2, &quot;don&apos;t&quot;: 1, &apos;not&apos;: 1, &apos;under&apos;: 1, &quot;you&apos;re&quot;: 1&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>通过某几个字典关键字段排序字典列表</li>
</ul>
<p>operator的itemgetter，支持多个key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">from operator import itemgetter</div><div class="line">rows_by_uid = sorted(rows, key=itemgetter(&apos;uid&apos;))</div><div class="line"># output</div><div class="line">[&#123;&apos;uid&apos;: 1001, &apos;lname&apos;: &apos;Cleese&apos;, &apos;fname&apos;: &apos;John&apos;&#125;, &#123;&apos;uid&apos;: 1002, &apos;lname&apos;: &apos;Beazley&apos;, &apos;fname&apos;: &apos;David&apos;&#125;, &#123;&apos;uid&apos;: 1003, &apos;lname&apos;: &apos;Jones&apos;, &apos;fname&apos;: &apos;Brian&apos;&#125;, &#123;&apos;uid&apos;: 1004, &apos;lname&apos;: &apos;Jones&apos;, &apos;fname&apos;: &apos;Big&apos;&#125;]</div><div class="line">rows_by_lfname = sorted(rows, key=itemgetter(&apos;lname&apos;,&apos;fname&apos;))</div><div class="line"># itemgetter()有时候也可以用lambda表达式代替，lambda比较慢，比如：</div><div class="line">rows_by_fname = sorted(rows, key=lambda r: r[&apos;fname&apos;])</div><div class="line">rows_by_lfname = sorted(rows, key=lambda r: (r[&apos;lname&apos;],r[&apos;fname&apos;]))</div><div class="line"># itemgetter同样适用于min、max的key关键字参数</div></pre></td></tr></table></figure>
<ul>
<li>排序不支持比较的对象</li>
</ul>
<p>sorted方法的key参数接收一个callable对象，该对象作用于每个排序的个体，根据其返回的值作为排序比较的依据，同理max，min函数。加入比较的是一类对象，key的接收函数可以定义为lambda函数，也可以使用operator.attrgetter(‘user_id’）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sorted(users, key=lambda u: u.user_id) </div><div class="line">### 二者均可，但是attrgetter运行速度更快，而且支持多个变量</div><div class="line">&gt;&gt;&gt; from operator import attrgetter</div><div class="line">&gt;&gt;&gt; sorted(users, key=attrgetter(&apos;user_id&apos;))</div><div class="line">[User(3), User(23), User(99)]</div></pre></td></tr></table></figure>
<ul>
<li>根据某个字段将数据分组</li>
</ul>
<p>先将数据排序，然后使用<code>itertools.groupby(&#39;key_field&#39;)</code>，或者使用 <code>collections.defaultdict（list）, dict_a[row[&#39;key_field&#39;]].append(row)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">from operator import itemgetter</div><div class="line">from itertools import groupby</div><div class="line">rows = [</div><div class="line">&#123;&apos;address&apos;: &apos;5412 N CLARK&apos;, &apos;date&apos;: &apos;07/01/2012&apos;&#125;,</div><div class="line">&#123;&apos;address&apos;: &apos;5148 N CLARK&apos;, &apos;date&apos;: &apos;07/04/2012&apos;&#125;,</div><div class="line">&#123;&apos;address&apos;: &apos;5800 E 58TH&apos;, &apos;date&apos;: &apos;07/02/2012&apos;&#125;,</div><div class="line">&#123;&apos;address&apos;: &apos;2122 N CLARK&apos;, &apos;date&apos;: &apos;07/03/2012&apos;&#125;,</div><div class="line">&#123;&apos;address&apos;: &apos;5645 N RAVENSWOOD&apos;, &apos;date&apos;: &apos;07/02/2012&apos;&#125;,</div><div class="line">&#123;&apos;address&apos;: &apos;1060 W ADDISON&apos;, &apos;date&apos;: &apos;07/02/2012&apos;&#125;,</div><div class="line">&#123;&apos;address&apos;: &apos;4801 N BROADWAY&apos;, &apos;date&apos;: &apos;07/01/2012&apos;&#125;,]</div><div class="line">l = groupby(rows, key=itemgetter(&apos;date&apos;)) //l值能被迭代一次</div><div class="line">for i, j in l:</div><div class="line">    print(i)</div><div class="line">    for z in j:</div><div class="line">        print(z)</div><div class="line"># 输出结果</div><div class="line">07/01/2012</div><div class="line">&#123;&apos;date&apos;: &apos;07/01/2012&apos;, &apos;address&apos;: &apos;5412 N CLARK&apos;&#125;</div><div class="line">&#123;&apos;date&apos;: &apos;07/01/2012&apos;, &apos;address&apos;: &apos;4801 N BROADWAY&apos;&#125;</div><div class="line">07/02/2012</div><div class="line">&#123;&apos;date&apos;: &apos;07/02/2012&apos;, &apos;address&apos;: &apos;5800 E 58TH&apos;&#125;</div><div class="line">&#123;&apos;date&apos;: &apos;07/02/2012&apos;, &apos;address&apos;: &apos;5645 N RAVENSWOOD&apos;&#125;</div><div class="line">&#123;&apos;date&apos;: &apos;07/02/2012&apos;, &apos;address&apos;: &apos;1060 W ADDISON&apos;&#125;</div><div class="line">07/03/2012</div><div class="line">&#123;&apos;date&apos;: &apos;07/03/2012&apos;, &apos;address&apos;: &apos;2122 N CLARK&apos;&#125;</div><div class="line">07/04/2012</div><div class="line">&#123;&apos;date&apos;: &apos;07/04/2012&apos;, &apos;address&apos;: &apos;5148 N CLARK&apos;&#125;</div><div class="line">### 使用defaultdict</div><div class="line">from collections import defaultdict</div><div class="line">rows_by_date = defaultdict(list)</div><div class="line">for row in rows:</div><div class="line">    rows_by_date[row[&apos;date&apos;]].append(row)</div></pre></td></tr></table></figure>
<ul>
<li>过滤序列元素</li>
</ul>
<p>最简单的方法，当过滤规则简单时，使用列表推导式或生成器表达式；<br>当过滤规则负责时，编写一个过滤规则函数(对每个元素返回True或False)，然后使用内建的filter()函数，filter(func, list_a)得到的是生成器，想要得到列表，可以使用list()函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">mylist = [1, 4, -5, 10, -7, 2, 3, -1]</div><div class="line">l = [n for n in mylist if n &gt; 0]</div><div class="line"># 上述的列表推导式会占用大量的内存，使用生成器表达式迭代产生要过滤的元素</div><div class="line">pos = (n for n in mylist if n &gt; 0)</div><div class="line">for i in pos:</div><div class="line">    print(i)</div><div class="line"></div><div class="line">def is_int(i):</div><div class="line">    try:</div><div class="line">        x = int(i)</div><div class="line">        return True</div><div class="line">    except ValueError:</div><div class="line">        return False</div><div class="line"></div><div class="line">l = list(filter(is_int, &apos;123wertsdfg&apos;))</div><div class="line">print(l)</div><div class="line"># 输出 [&apos;1&apos;, &apos;2&apos;, &apos;3&apos;]</div></pre></td></tr></table></figure>
<p>使用列表推导式，可以同时转换(处理)符合条件的数据；也可以替换(处理)不符合条件的结果，而不是直接丢弃。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import math</div><div class="line">l1 = [math.sqrt(n) for n in mylist if n &gt; 0]</div><div class="line">l2 = [n if n &gt; 0 else 0 for n in mylist]</div></pre></td></tr></table></figure>
<p>另外一个值得关注的过滤工具就是itertools.compress()，它以一个iterable对象和一个相对应的Boolean选择器序列作为输入参数。然后输出iterable对象中对应选择器为True的元素,是个生成器。当你需要用另外一个相关联的序列来过滤某个序列的时候，这个函数是非常有用的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 关键点在于先创建一个Boolean序列，指示哪些元素复合条件。然后</div><div class="line">compress()函数根据这个序列去选择输出对应位置为True的元素。</div><div class="line">from itertools import compress</div><div class="line"></div><div class="line">s = [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;]</div><div class="line">count = [99, 20, 16, 71, 56]</div><div class="line">big50 = [n &gt; 50 for n in count]</div><div class="line">l = list(compress(s, big50))</div><div class="line">print(l)</div><div class="line"># 输出 [&apos;a&apos;, &apos;d&apos;, &apos;e&apos;]</div></pre></td></tr></table></figure>
<ul>
<li>从字典中提取子集</li>
</ul>
<p>首先考虑字典推导,dict()函数传入元组的推导式也可以实现，但比字典推到速度慢1倍：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">prices = &#123;</div><div class="line">&apos;ACME&apos;: 45.23,</div><div class="line">&apos;AAPL&apos;: 612.78,</div><div class="line">&apos;IBM&apos;: 205.55,</div><div class="line">&apos;HPQ&apos;: 37.20,</div><div class="line">&apos;FB&apos;: 10.75</div><div class="line">&#125;</div><div class="line"># Make a dictionary of all prices over 200</div><div class="line">p1 = &#123;key: value for key, value in prices.items() if value &gt; 200&#125;</div><div class="line"># Make a dictionary of tech stocks</div><div class="line">tech_names = &#123;&apos;AAPL&apos;, &apos;IBM&apos;, &apos;HPQ&apos;, &apos;MSFT&apos;&#125;</div><div class="line">p2 = &#123;key: value for key, value in prices.items() if key in tech_names&#125;</div><div class="line"># dict()方式慢</div><div class="line">p1 = dict((key, value) for key, value in prices.items() if value &gt; 200)</div></pre></td></tr></table></figure>
<ul>
<li>映射名称到序列， 命名元组<br>替代不可读的下标，或作为有大量字典元素的替代，节省空间，但命名元组的元素是不可修改的，（可以_replace()方法更新，如果需要大量更新，则不适合使用nametuple）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">from collections import namedtuple</div><div class="line">namedtuple(typename,field_names,verbose=False,rename=False)</div><div class="line"># 返回一个类，但该类支持元组操作，是元组类的一个子类</div><div class="line">Subscriber = namedtuple(&apos;Subscriber&apos;, [&apos;addr&apos;, &apos;joined&apos;])</div><div class="line">sub = Subscriber(&apos;jonesy@example.com&apos;, &apos;2012-10-19&apos;)</div><div class="line">print(sub.addr, sub.joined)</div><div class="line">a, b = sub</div><div class="line">len(sub)</div><div class="line"># 使用命名元组增加可读性的一个例子</div><div class="line">from collections import namedtuple</div><div class="line"></div><div class="line">Stock = namedtuple(&apos;Stock&apos;, [&apos;name&apos;, &apos;shares&apos;, &apos;price&apos;])</div><div class="line"></div><div class="line">def compute_cost(records): //records [[price, nums],]</div><div class="line">	total = 0.0</div><div class="line">	for rec in records:</div><div class="line">		s = Stock(*rec)</div><div class="line">		total += s.shares * s.price</div><div class="line">	return total</div><div class="line">## 如果非要改变命名元组的属性，可以使用_replace()方法。该方法常用于填充数据，返回一个新的元组实例</div><div class="line"># 比如我们命名了一个具有缺省值的默认元组，用该方法创建实例</div><div class="line">stock_prototype = Stock(&apos;&apos;, 0, 0.0, None, None)</div><div class="line"></div><div class="line">def dict_to_stock(s):</div><div class="line">	return stock_prototype._replace(**s)</div></pre></td></tr></table></figure>
<ul>
<li>转换并同时处理数据</li>
</ul>
<p>处理函数与生成器参数结合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">s = sum(x*x for x in nums)</div><div class="line">import os </div><div class="line">if any(name.endswith(&apos;.py&apos;) for name in os.listdir(&apos;.&apos;)):</div><div class="line">    print(1)</div><div class="line">s = (&apos;ACME&apos;, 50, 123.45)</div><div class="line">print(&apos;,&apos;.join(str(x) for x in s))</div></pre></td></tr></table></figure>
<ul>
<li>合并多个字典或映射<br>使用collections.ChainMap()或dict的update方法，update会改变原有的字典结构，或创建新的字典对象，（当原字典更新时，update无法反应这种改变）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">a = &#123;&apos;x&apos;: 1, &apos;z&apos;: 3 &#125;</div><div class="line">b = &#123;&apos;y&apos;: 2, &apos;z&apos;: 4 &#125;</div><div class="line"># 现在假设你必须在两个字典中执行查找操作(比如先从a中找，如果找不到再在b中找)</div><div class="line">from collections import ChainMap</div><div class="line">c = ChainMap(a,b) //字典的列表容器，仍支持大部分字典的方法</div><div class="line">print(c[&apos;x&apos;]) # (from a)</div><div class="line">print(c[&apos;y&apos;]) # (from b)</div><div class="line">print(c[&apos;z&apos;]) # (from a)，永远只输出第一个匹配字典的结果</div><div class="line"># 对于字典的更新或删除操作总是影响的是列表中第一个字典。</div><div class="line">del c[&apos;z&apos;]</div></pre></td></tr></table></figure>
<h3 id="字符串和文本"><a href="#字符串和文本" class="headerlink" title="字符串和文本"></a>字符串和文本</h3><h3 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h3><h3 id="迭代器和生成器"><a href="#迭代器和生成器" class="headerlink" title="迭代器和生成器"></a>迭代器和生成器</h3><h3 id="文件和IO"><a href="#文件和IO" class="headerlink" title="文件和IO"></a>文件和IO</h3><h3 id="数据编码和处理"><a href="#数据编码和处理" class="headerlink" title="数据编码和处理"></a>数据编码和处理</h3><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h3 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h3><h3 id="元编程"><a href="#元编程" class="headerlink" title="元编程"></a>元编程</h3><h3 id="模块和包"><a href="#模块和包" class="headerlink" title="模块和包"></a>模块和包</h3><h3 id="网络和web编程"><a href="#网络和web编程" class="headerlink" title="网络和web编程"></a>网络和web编程</h3><h3 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h3><h3 id="脚本和系统管理"><a href="#脚本和系统管理" class="headerlink" title="脚本和系统管理"></a>脚本和系统管理</h3><h3 id="异常、调试、测试"><a href="#异常、调试、测试" class="headerlink" title="异常、调试、测试"></a>异常、调试、测试</h3>
      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-10-29T16:00:00.000Z"><a href="/2016/10/30/技术/zabbix/">2016-10-30</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/10/30/技术/zabbix/">zabbix部署</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#zabbix-appliance-部署"><span class="toc-text">zabbix appliance 部署</span></a></li></ol>
    </div>

      
        <h3 id="zabbix-appliance-部署"><a href="#zabbix-appliance-部署" class="headerlink" title="zabbix appliance 部署"></a>zabbix appliance 部署</h3><ul>
<li>登陆 appliance：zabbix</li>
<li>修改中文支持<br>修改你的 locales . inc . php 这个文件，/usr/share/zabbix/include/ 下<br>‘zh<em>CN’ =&gt; [‘name’ =&gt; </em>(‘Chinese (zh_CN)’), ‘display’ =&gt; true], #也就是把false改为true<br>，在web页面点击用户信息头像，选择语言。</li>
</ul>
<p>解决图形字体乱码<br>修改你的defines.inc.php 这个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#修改第93行</div><div class="line">define(&apos;ZBX_FONT_NAME&apos;, &apos;msyh&apos;); </div><div class="line">#修改第45行改为 </div><div class="line">define(&apos;ZBX_GRAPH_FONT_NAME&apos;, &apos;msyh&apos;)</div></pre></td></tr></table></figure>
<p>然后下载微软雅黑字体，传入zabbix/fonts下，<br>架设服务器，<code>python -m SimpleHTTPServer 8080</code></p>
<p>配置snmp server</p>

      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-09-21T16:00:00.000Z"><a href="/2016/09/22/技术/git-server-on-centos/">2016-09-22</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/09/22/技术/git-server-on-centos/">搭建Git服务器</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#cent-os-搭建git-server-gitolite"><span class="toc-text">cent os 搭建git server + gitolite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、安装git"><span class="toc-text">1、安装git</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1、创建git用户"><span class="toc-text">1.1、创建git用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2、更改git目录权限"><span class="toc-text">1.2、更改git目录权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3、源码安装git"><span class="toc-text">1.3、源码安装git</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、安装gitolite"><span class="toc-text">2、安装gitolite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、配置gitolite管理员"><span class="toc-text">3、配置gitolite管理员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、ssh配置"><span class="toc-text">4、ssh配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、gitolite添加用户、库，设置用户管理权限"><span class="toc-text">5、gitolite添加用户、库，设置用户管理权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6、git基础教程"><span class="toc-text">6、git基础教程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1、基本操作"><span class="toc-text">6.1、基本操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2、分支操作"><span class="toc-text">6.2、分支操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3、更改提交"><span class="toc-text">6.3、更改提交</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4、推送至远程仓库"><span class="toc-text">6.4、推送至远程仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5、从远程仓库获取"><span class="toc-text">6.5、从远程仓库获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6、在线git命令练习"><span class="toc-text">6.6、在线git命令练习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-7、git命令备忘录"><span class="toc-text">6.7、git命令备忘录</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#创建版本库"><span class="toc-text">创建版本库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改和提交"><span class="toc-text">修改和提交</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#查看提交历史"><span class="toc-text">查看提交历史</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#撤销"><span class="toc-text">撤销</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#分支与标签"><span class="toc-text">分支与标签</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#合并与衍合"><span class="toc-text">合并与衍合</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#远程操作"><span class="toc-text">远程操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7、github"><span class="toc-text">7、github</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1、开始"><span class="toc-text">7.1、开始</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2、使用"><span class="toc-text">7.2、使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3、GitHUb-Flow-————以部署为中心的开发模式"><span class="toc-text">7.3、GitHUb Flow ————以部署为中心的开发模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8、Git-server-使用指导"><span class="toc-text">8、Git server 使用指导</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1、将自己的代码上传到远程仓库"><span class="toc-text">8.1、将自己的代码上传到远程仓库</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>

      
        <h1 id="cent-os-搭建git-server-gitolite"><a href="#cent-os-搭建git-server-gitolite" class="headerlink" title="cent os 搭建git server + gitolite"></a>cent os 搭建git server + gitolite</h1><blockquote>
<p>爬了很久的坑，终于爬出来了，真累。说说走的弯路，最初打算配置gitlab（有和github一样漂亮的web界面），然后下源码编译，失败。后来发现gitlab有中文站，提供二进制包，可能是centos32位的原因，为了少浪费生命，果断放弃，转而采用git-core + gitolite。</p>
</blockquote>
<h3 id="1、安装git"><a href="#1、安装git" class="headerlink" title="1、安装git"></a>1、安装git</h3><h4 id="1-1、创建git用户"><a href="#1-1、创建git用户" class="headerlink" title="1.1、创建git用户"></a>1.1、创建git用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># yum update</span></div><div class="line"><span class="comment"># yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-devel</span></div><div class="line"><span class="comment"># mkdir -p /home/git  //创建git用户的目录</span></div><div class="line"><span class="comment"># groupadd git  //创建git用户组</span></div><div class="line"><span class="comment"># useradd -g git -d /home/git -s /bin/bash git  // 添加linux用户git</span></div><div class="line"><span class="comment"># passwd git    //设置git用户密码</span></div><div class="line"></div><div class="line"><span class="comment"># passwd -d git  //在所有工作完成后禁用git用户的密码，这样git无法ssh远程登录主机</span></div></pre></td></tr></table></figure>
<h4 id="1-2、更改git目录权限"><a href="#1-2、更改git目录权限" class="headerlink" title="1.2、更改git目录权限"></a>1.2、更改git目录权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># chown -R git:git /home/git</span></div><div class="line"><span class="comment"># chmod -R 2755 /home/git</span></div></pre></td></tr></table></figure>
<h4 id="1-3、源码安装git"><a href="#1-3、源码安装git" class="headerlink" title="1.3、源码安装git"></a>1.3、源码安装git</h4><p>先从官网 <a href="http://git-scm.com/download" target="_blank" rel="external">http://git-scm.com/download</a> 上下载 git源码，<br>然后解压，<code>tar -zxvf git-xxx.xxx.tar.gz</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">系统默认版本为1.8.3，版本太老，删除并通过源代码安装</div><div class="line">删除安装的git</div><div class="line">yum -y remove git</div><div class="line">安装git依赖包</div><div class="line">$ sudo yum install curl-devel expat-devel gettext-devel openssl-devel perl-devel zlib-devel</div><div class="line">下载源码并编译安装 </div><div class="line">mkdir /tmp/git &amp;&amp; <span class="built_in">cd</span> /tmp/git </div><div class="line">curl --progress https://www.kernel.org/pub/software/scm/git/git-2.8.2.tar.gz | tar xz </div><div class="line"><span class="built_in">cd</span> git-2.8.2/ </div><div class="line">./configure </div><div class="line">make </div><div class="line">make prefix=/usr/<span class="built_in">local</span> install</div><div class="line">为确保<span class="variable">$PATH</span>环境变量生效，需要重新连接后执行git --version</div><div class="line">ctrl + d 关闭ssh会话，然后重新ssh登录。</div></pre></td></tr></table></figure>
<h3 id="2、安装gitolite"><a href="#2、安装gitolite" class="headerlink" title="2、安装gitolite"></a>2、安装gitolite</h3><blockquote>
<p>参照官方的quick install，只需3行命令</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># su – git  //切换到git用户下安装</div><div class="line">$ pwd</div><div class="line"> /home/git</div><div class="line">$ mkdir bin</div><div class="line">// 获取源码</div><div class="line">$ git clone https://github.com/sitaramc/gitolite.git</div><div class="line">或者git clone git://github.com/ossxp-com/gitolite.git</div><div class="line"> $ ls</div><div class="line"> bin gitolite</div><div class="line">// 安装</div><div class="line">$ ./gitolite/install --to /home/git/bin/</div><div class="line">$ ls bin/</div><div class="line">commands  gitolite  gitolite-shell  lib  syntactic-sugar  triggers  VERSION  VREF</div></pre></td></tr></table></figure>
<h3 id="3、配置gitolite管理员"><a href="#3、配置gitolite管理员" class="headerlink" title="3、配置gitolite管理员"></a>3、配置gitolite管理员</h3><p>首先生成rsa key,然后用管理员的public key初始化gitolite</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// Windows安装git for windows2.6.2，安装完后打开Git Bash</div><div class="line">$ ssh-keygen –f admin –C 20151030@qq.com</div><div class="line">$ scp admin.pub git@serverIP:/tmp/admin.pub</div><div class="line">//	切换到git用户，为gitolite配置管理员</div><div class="line">$ su - git</div><div class="line">$ bin/gitolite setup -pk /tmp/admin.pub</div><div class="line">	Initialized empty Git repository in /home/git/repositories/gitolite-admin.git</div><div class="line">/Initialized empty Git repository in /home/git/repositories/testing.git/</div><div class="line">WARNING: /home/git/.ssh missing; creating a new one    </div><div class="line">(this is normal on a brand new install)</div><div class="line">WARNING: /home/git/.ssh/authorized_keys missing; creating a new one    </div><div class="line">(this is normal on a brand new install)</div><div class="line">$ ls</div><div class="line">      bin  gitolite  projects.list  repositories</div></pre></td></tr></table></figure>
<h3 id="4、ssh配置"><a href="#4、ssh配置" class="headerlink" title="4、ssh配置"></a>4、ssh配置</h3><p>服务端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">su -</div><div class="line">// 	vim /etc/ssh/sshd_config，将下面几句前面的#号去掉</div><div class="line">RSAAuthentication yes</div><div class="line">PubkeyAuthentication yes</div><div class="line">AuthorizedKeysFile      .ssh/authorized_keys</div><div class="line">AuthorizedKeysCommand none</div><div class="line">AuthorizedKeysCommandRunAs nobody</div><div class="line">// 重启ssh</div><div class="line">service sshd restart</div></pre></td></tr></table></figure>
<p>客户端的git bash，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">在 ~/.ssh/config 添加以下内容，以便连接到服务器</div><div class="line">Host 192.168.1.254</div><div class="line">Compression yes</div><div class="line">IdentityFile ~/.ssh/id_rsa</div></pre></td></tr></table></figure>
<h3 id="5、gitolite添加用户、库，设置用户管理权限"><a href="#5、gitolite添加用户、库，设置用户管理权限" class="headerlink" title="5、gitolite添加用户、库，设置用户管理权限"></a>5、gitolite添加用户、库，设置用户管理权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">1.	windows安装TortoiseGit</div><div class="line">2.	新建git文件夹，进入，右键Git Clone…</div><div class="line">URL: git@serverIP:gitolite-admin.git</div><div class="line">      勾选Load Putty Key，选择你的私钥（此处需使用ppk格式私钥，可以使用puttygen将私钥admin转换成admin.ppk）</div><div class="line">	点击OK即可clone服务器上的gitolite-admin文件夹到本地</div><div class="line">3.	添加用户</div><div class="line">管理员将其他用户的公钥(如dong.pub)复制到gitolite-admin/keydir/下</div><div class="line">4.	添加库</div><div class="line">进入gitolite-admin/conf/，右键Git Bash Here，</div><div class="line">$ vim gitolite.conf (此文件用于添加库和配置用户对库的权限)</div><div class="line">repo gitolite-admin    </div><div class="line">    RW+     =   admin</div><div class="line">repo testing    </div><div class="line">    RW+     =   @all</div><div class="line">		repo git-dong           #新建库git-dong</div><div class="line">      RW+  =  admin dong #设置用户admin dong有读写权限</div><div class="line"> 将修改push到服务器，即可添加库和用户。:wq</div><div class="line"></div><div class="line">$ cd ..</div><div class="line">$ git status 						#查看git库状态</div><div class="line">$ git add keydir/dong.pub conf/gitolite.conf  或者git add .</div><div class="line">$ git commit –m “add repo git-admin;add user dong”</div><div class="line">进入gitolite-admin文件夹，右键TortoiseGitPush</div><div class="line">点击OK即可。</div><div class="line">5.	用户权限管理</div><div class="line">在客户端clone gitolite-admin.git,编辑gitolite-admin/conf/gitolite.conf配置各用户权限。</div><div class="line">1	 @team1 = zc</div><div class="line">2	@team2 = aws zc</div><div class="line">3   repo gitolite-admin</div><div class="line">4       RW+                 = admin</div><div class="line">5</div><div class="line">6   repo ossxp/.+</div><div class="line">7       C                   = admin</div><div class="line">8       RW                  = @all</div><div class="line">9</div><div class="line">10  repo testing</div><div class="line">11      RW+                         =   admin</div><div class="line">12      RW      master              =   junio</div><div class="line">13      RW+     pu                  =   junio</div><div class="line">14      RW      cogito$             =   pasky</div><div class="line">15      RW      bw/                 =   linus</div><div class="line">16      -                           =   somebody</div><div class="line">17      RW      tmp/                =   @all</div><div class="line">18      RW      refs/tags/v[0-9]    =   junio</div><div class="line">在上面的示例中，我们演示了很多授权指令。</div><div class="line">•	第1行，定义了用户组 @admin，包含两个用户 jiangxin 和 wangsheng。</div><div class="line">•	第3-4行，定义了版本库 gitolite-admin。并指定只有用户 jiangxin 才能够访问，并拥有读(R)写(W)和强制更新(+)的权限。</div><div class="line">•	第6行，通过正则表达式定义了一组版本库，即在 ossxp/ 目录下的所有版本库。</div><div class="line">•	第7行，用户组 @admin 中的用户，可以在 ossxp/ 目录下创建版本库。</div><div class="line">创建版本库的用户，具有对版本库操作的所有权限。</div><div class="line">•	第8行，所有用户都可以读写 ossxp 目录下的版本库，但不能强制更新。</div><div class="line">•	第9行开始，定义的 testing 版本库授权使用了引用授权语法。</div><div class="line">•	第11行，用户组 @admin 对所有的分支和里程碑拥有读写、重置、添加和删除的授权。</div><div class="line">•	第12行，用户 junio 可以读写 master 分支。（还包括名字以 master 开头的其他分支，如果有的话）。</div><div class="line">•	第13行，用户 junio 可以读写、强制更新、创建以及删除 pu 开头的分支。</div><div class="line">第14行，用户 pasky 可以读写 cogito 分支。 (仅此分支，精确匹配）。</div></pre></td></tr></table></figure>
<hr>
<p>以下是通过修改gitolite-admin库，管理git用户和权限。添加新用户wuxiaohui的公钥，赋予其读写testing.git库的权限。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">## 对权限文件配置gitolite.conf的修改</div><div class="line">repo gitolite-admin</div><div class="line">    RW+     =   admin</div><div class="line"></div><div class="line">repo testing</div><div class="line">    RW+     =   @all</div><div class="line"></div><div class="line">repo new-source</div><div class="line">    RW+     =  wuxiaohui Chenchuneng maning</div></pre></td></tr></table></figure>
<p>修改完成后push到git server。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">shuaiyy@shuaiyy-PC MINGW64 /g/git/gitolite-admin (master)</div><div class="line">$ git status</div><div class="line">On branch master</div><div class="line">Your branch is up-to-date with &apos;origin/master&apos;.</div><div class="line">Changes not staged for commit:</div><div class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</div><div class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</div><div class="line"></div><div class="line">        modified:   conf/gitolite.conf</div><div class="line"></div><div class="line">Untracked files:</div><div class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</div><div class="line"></div><div class="line">        keydir/wuxiaohui.pub</div><div class="line"></div><div class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</div><div class="line"></div><div class="line">shuaiyy@shuaiyy-PC MINGW64 /g/git/gitolite-admin (master)</div><div class="line">$ git add keydir/wuxiaohui.pub conf/gitolite.conf</div><div class="line">warning: LF will be replaced by CRLF in keydir/wuxiaohui.pub.</div><div class="line">The file will have its original line endings in your working directory.</div><div class="line"></div><div class="line">shuaiyy@shuaiyy-PC MINGW64 /g/git/gitolite-admin (master)</div><div class="line"></div><div class="line">shuaiyy@shuaiyy-PC MINGW64 /g/git/gitolite-admin (master)</div><div class="line">$ git commit -m &quot;add repo new-source;add user wuxiaohui&quot;</div><div class="line">[master bf3f6fe] add repo new-source;add user wuxiaohui</div><div class="line">warning: LF will be replaced by CRLF in keydir/wuxiaohui.pub.</div><div class="line">The file will have its original line endings in your working directory.</div><div class="line"> 2 files changed, 4 insertions(+)</div><div class="line"> create mode 100644 keydir/wuxiaohui.pub</div></pre></td></tr></table></figure>
<h3 id="6、git基础教程"><a href="#6、git基础教程" class="headerlink" title="6、git基础教程"></a>6、git基础教程</h3><h4 id="6-1、基本操作"><a href="#6-1、基本操作" class="headerlink" title="6.1、基本操作"></a>6.1、基本操作</h4><ul>
<li><p>git init<br>要想使用git进行版本管理，必须先初试化仓库。<br>新建一个文件夹，在该文件夹下执行 git init 命令，就可以将该文件夹初始化为git仓库，其下会生成<code>.git</code>的文件夹，记录git的版本追踪管理，千万不要删除或更改。</p>
</li>
<li><p>git status<br>显示当前仓库的状态，<br><img src="http://ww3.sinaimg.cn/large/af9df239jw1f8l217hqwij20gj0950sx.jpg" alt="">，如 处于master分支，没有修改内容。</p>
</li>
<li><p>git add<br>我们创建的文件不会被自动加入git仓库的管理文件中，必须使用<code>git add filename</code>或<code>git add .</code>使其加入本地的Index暂存区。<br>然后git status 查看改变。</p>
</li>
<li><p>git commit -m “First Commit !”<br>将git add的内容提交，保存到版本管理的历史记录中。<br>git status 查看状态。</p>
</li>
<li><p>git log<br>查看日志，其中 commit ID是版本号，如果想要改变到某个版本，需要指定版本号。<br>git log file/dir 查看指定文件或文件夹的日志</p>
</li>
<li><p>git diff</p>
</li>
</ul>
<p>查看当前状态和最新提交，历史版本的不同之处。<br>其中<code>+</code>代表新增，<code>-</code>代表删除；</p>
<h4 id="6-2、分支操作"><a href="#6-2、分支操作" class="headerlink" title="6.2、分支操作"></a>6.2、分支操作</h4><ul>
<li>git branch 显示分支一览表</li>
<li>git checkout -b  创建、切换分支</li>
<li>git merge   合并分支</li>
<li>git log –graph  以图表形式查看分支</li>
</ul>
<h4 id="6-3、更改提交"><a href="#6-3、更改提交" class="headerlink" title="6.3、更改提交"></a>6.3、更改提交</h4><ul>
<li>git reset    回溯历史版本</li>
<li>git commit –amend     修改提交信息</li>
<li>git rebase -i        压缩历史</li>
</ul>
<h4 id="6-4、推送至远程仓库"><a href="#6-4、推送至远程仓库" class="headerlink" title="6.4、推送至远程仓库"></a>6.4、推送至远程仓库</h4><ul>
<li>git remote add  添加远程仓库</li>
<li>git push   推送至远程仓库</li>
</ul>
<h4 id="6-5、从远程仓库获取"><a href="#6-5、从远程仓库获取" class="headerlink" title="6.5、从远程仓库获取"></a>6.5、从远程仓库获取</h4><ul>
<li>git clone 获取远程仓库到本地</li>
<li>git pull  获取最新的远程仓库分支</li>
</ul>
<h4 id="6-6、在线git命令练习"><a href="#6-6、在线git命令练习" class="headerlink" title="6.6、在线git命令练习"></a>6.6、在线git命令练习</h4><ul>
<li><a href="http://learngitbranching.js.org/?demo" target="_blank" rel="external">LearnGitBranching</a> 提供在线的git命令学习与实践<br><img src="http://ww2.sinaimg.cn/large/af9df239gw1f8o6jczv5sj211y0hd75i.jpg" alt=""></li>
<li><a href="https://try.github.io/levels/1/challenges/1" target="_blank" rel="external">Try Git</a><br><img src="http://ww2.sinaimg.cn/large/af9df239gw1f8o6kf31izj21130hk3zm.jpg" alt=""></li>
</ul>
<h4 id="6-7、git命令备忘录"><a href="#6-7、git命令备忘录" class="headerlink" title="6.7、git命令备忘录"></a>6.7、git命令备忘录</h4><p>master: 默认开发分支</p>
<p>origin: 默认远程版本库</p>
<p>Head: 默认开发分支</p>
<p>Head^: Head的父提交</p>
<h5 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git clone &lt;url&gt;   #克隆远程版本库</div><div class="line">$ git init          #初始化本地版本库</div></pre></td></tr></table></figure>
<h5 id="修改和提交"><a href="#修改和提交" class="headerlink" title="修改和提交"></a>修改和提交</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ git status        #查看状态</div><div class="line">$ git diff          #查看变更内容</div><div class="line">$ git add .         #跟踪所有改动过的文件</div><div class="line">$ git add &lt;file&gt;    #跟踪指定的文件</div><div class="line">$ git mv &lt;old&gt;&lt;new&gt; #文件改名</div><div class="line">$ git rm&lt;file&gt;      #删除文件</div><div class="line">$ git rm --cached&lt;file&gt;            #停止跟踪文件但不删除</div><div class="line">$ git commit -m &quot;commit messages&quot;  #提交所有更新过的文件</div><div class="line">$ git commit --amend               #修改最后一次改动</div></pre></td></tr></table></figure>
<h5 id="查看提交历史"><a href="#查看提交历史" class="headerlink" title="查看提交历史"></a>查看提交历史</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git log                    #查看提交历史</div><div class="line">$ git log -p &lt;file&gt;          #查看指定文件的提交历史</div><div class="line">$ git blame &lt;file&gt;           #以列表方式查看指定文件的提交历史</div></pre></td></tr></table></figure>
<h5 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git reset --hard HEAD      #撤销工作目录中所有未提交文件的修改内容</div><div class="line">$ git checkout HEAD &lt;file&gt;   #撤销指定的未提交文件的修改内容</div><div class="line">$ git revert &lt;commit&gt;        #撤销指定的提交</div><div class="line">$ git log --before=&quot;1 days&quot;  #退回到之前1天的版本</div></pre></td></tr></table></figure>
<h5 id="分支与标签"><a href="#分支与标签" class="headerlink" title="分支与标签"></a>分支与标签</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ git branch                   #显示所有本地分支</div><div class="line">$ git checkout &lt;branch/tag&gt;    #切换到指定分支和标签</div><div class="line">$ git branch &lt;new-branch&gt;      #创建新分支</div><div class="line">$ git branch -d &lt;branch&gt;       #删除本地分支</div><div class="line">$ git tag                      #列出所有本地标签</div><div class="line">$ git tag &lt;tagname&gt;            #基于最新提交创建标签</div><div class="line">$ git tag -d &lt;tagname&gt;         #删除标签</div></pre></td></tr></table></figure>
<h5 id="合并与衍合"><a href="#合并与衍合" class="headerlink" title="合并与衍合"></a>合并与衍合</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git merge &lt;branch&gt;        #合并指定分支到当前分支</div><div class="line">$ git rebase &lt;branch&gt;       #衍合指定分支到当前分支</div></pre></td></tr></table></figure>
<h5 id="远程操作"><a href="#远程操作" class="headerlink" title="远程操作"></a>远程操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ git remote -v                   #查看远程版本库信息</div><div class="line">$ git remote show &lt;remote&gt;        #查看指定远程版本库信息</div><div class="line">$ git remote add &lt;remote&gt; &lt;url&gt;   #添加远程版本库</div><div class="line">$ git fetch &lt;remote&gt;              #从远程库获取代码</div><div class="line">$ git pull &lt;remote&gt; &lt;branch&gt;      #下载代码及快速合并</div><div class="line">$ git push &lt;remote&gt; &lt;branch&gt;      #上传代码及快速合并</div><div class="line">$ git push &lt;remote&gt; :&lt;branch/tag-name&gt;  #删除远程分支或标签</div><div class="line">$ git push --tags                       #上传所有标签</div></pre></td></tr></table></figure>
<h3 id="7、github"><a href="#7、github" class="headerlink" title="7、github"></a>7、github</h3><p>GitHub 除了 Git 代码仓库托管及基本的 Web 管理界面以外，还提供了订阅、讨论组、文本渲染、在线文件编辑器、协作图谱（报表）、代码片段分享（Gist）等功能。<br><img src="http://ww2.sinaimg.cn/large/af9df239gw1f8l3d9ohe9j211o0hg3zk.jpg" alt=""></p>
<p>Github的三个精彩功能 fork，star，watch</p>
<p>1.想拷贝别人项目到自己帐号下就fork一下。<br>2.持续关注别人项目更新就star一下<br>3.watch是设置接收邮件提醒的。</p>
<p><img src="http://ww3.sinaimg.cn/large/af9df239gw1f8l3dnmghtj211w0hhq47.jpg" alt=""></p>
<h4 id="7-1、开始"><a href="#7-1、开始" class="headerlink" title="7.1、开始"></a>7.1、开始</h4><ul>
<li>创建账户</li>
<li>完善个人信息</li>
<li>设置Key</li>
<li>添加公钥</li>
</ul>
<h4 id="7-2、使用"><a href="#7-2、使用" class="headerlink" title="7.2、使用"></a>7.2、使用</h4><ul>
<li>创建仓库</li>
<li>连接仓库</li>
<li>提交开源代码</li>
<li>Github Desktop </li>
</ul>
<h4 id="7-3、GitHUb-Flow-————以部署为中心的开发模式"><a href="#7-3、GitHUb-Flow-————以部署为中心的开发模式" class="headerlink" title="7.3、GitHUb Flow ————以部署为中心的开发模式"></a>7.3、GitHUb Flow ————以部署为中心的开发模式</h4><p>GitHub Flow</p>
<ul>
<li>保持master分支始终是可部署使用的</li>
<li>新的开发要从master分支创建新的分支，分支名要有描述性意义</li>
<li>在本地仓库的新建分支提交</li>
<li>PUSH本地分支作业到github服务器端的同名分支</li>
<li>审查测试push的新分支，确认无误后与master合并</li>
<li>合并后的master分支可以立即投入使用，如果有bug，和回退到提交状态之前</li>
</ul>
<h3 id="8、Git-server-使用指导"><a href="#8、Git-server-使用指导" class="headerlink" title="8、Git server 使用指导"></a>8、Git server 使用指导</h3><h4 id="8-1、将自己的代码上传到远程仓库"><a href="#8-1、将自己的代码上传到远程仓库" class="headerlink" title="8.1、将自己的代码上传到远程仓库"></a>8.1、将自己的代码上传到远程仓库</h4><p>我在 project 目录下创建了4个用户对应的仓库 Chenchuneng.git  Maning.git  Wuxiaohui.git  Wangba.git<br>因此对应的git仓库地址为： git@121.41.15.6:project/<strong>Wangba</strong>.git<br>使用git clone 克隆到本地：<br><img src="http://ww1.sinaimg.cn/large/af9df239jw1f8og5y58quj20ep0acmxq.jpg" alt=""></p>
<p>假如我的workspace目录下有2个项目源码，project1，project2，想上传project1到远程仓库 Wangba.git。</p>
<ol>
<li>在workspace下打开git bash here，执行 <code>git init</code> 初试化本地仓库</li>
<li><code>git add project1</code>,添加需要git log的文件，<code>git add .</code>可以添加所有变更的文件，省事。</li>
<li><code>git commit -m &quot; 备注&quot;</code>，提交变化到本地仓库</li>
<li><code>git remote add mywork git@121.41.15.6:project/Yangshuai.git</code>,为本地仓库添加远程仓库，命令中的mywork 是我们为远程仓库起的别名（可以自己任取），然后push的时候使用别名 mywork 就可以少打很多字了。</li>
<li>将本地仓库push到服务器上的远程仓库，右键workspace，选择Tortogit小乌龟里的push命令：<img src="http://ww1.sinaimg.cn/large/af9df239jw1f8ogjhhnq2j20do0dqaax.jpg" alt=""></li>
<li>以后修改添加的代码想要上传至git服务器，重复 2 3 5步骤，即 add commit push。其他目录下的代码想要上传的话，重复步骤 1-6 。</li>
</ol>
<p>注意：git clone 和git push 我们都是用的程序而不是命令行，是因为在git bash 下如何配置git服务器认证所需的ssh-key暂时没找到解决方法，而GUI工具可以”load ssh key”。  </p>

      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-08-18T16:00:00.000Z"><a href="/2016/08/19/技术/Django模板语法/">2016-08-19</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/08/19/技术/Django模板语法/">Django 模板语法</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Django模板语法"><span class="toc-text">Django模板语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模板变量"><span class="toc-text">模板变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#条件分支"><span class="toc-text">条件分支</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#循环"><span class="toc-text">循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#过滤器-filter"><span class="toc-text">过滤器 filter</span></a></li></ol></li></ol>
    </div>

      
        <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#django%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95">Django模板语法</a><ul>
<li><a href="#%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F">模板变量</a></li>
<li><a href="#%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF">条件分支</a></li>
<li><a href="#%E5%BE%AA%E7%8E%AF">循环</a></li>
<li><a href="#%E8%BF%87%E6%BB%A4%E5%99%A8-filter">过滤器 filter</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Django模板语法"><a href="#Django模板语法" class="headerlink" title="Django模板语法"></a>Django模板语法</h2><h3 id="模板变量"><a href="#模板变量" class="headerlink" title="模板变量"></a>模板变量</h3><ul>
<li><code> {{var_name}} </code>,view视图传入参数可以为<code> Context({'name':'vale',})</code></li>
<li><code>{{dict.key}}</code>,view视图传入参数为dict字典</li>
<li><code>{{object_name.attribute 或 method}} </code>,view视图传入一个对象object。</li>
<li><code>{{list_name.N}}</code>,view视图出入一个list，可以取出list的第N个元素。</li>
</ul>
<h3 id="条件分支"><a href="#条件分支" class="headerlink" title="条件分支"></a>条件分支</h3><ul>
<li><p><code>{% if user.age < 18 %} <li>未成年</li>{% else %} XXX {% endif %} </code></p>
</li>
<li><p>条件中的逻辑关系词 and or not，其中and与or不能同时使用。</p>
</li>
</ul>
<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><ul>
<li><p>for</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;% raw %&#125;</div><div class="line">&#123;% for  book in booklist reversed %&#125;     &#123;&#123;book&#125;&#125;</div><div class="line">&#123;&#123;% empty %&#125;&#125;</div><div class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;forloop.counter&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;forloop.revcounter&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;foorloop.counter0&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;forloop.revcounter0&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">&#123;% endfor %&#125;</div><div class="line">&#123;% for  key in dict %&#125; </div><div class="line">    &#123;&#123;key&#125;&#125;  </div><div class="line">&#123;% endfor %&#125;</div><div class="line">&#123;% endraw %&#125;</div></pre></td></tr></table></figure>
<p>reversed 是逆序输出,{{% empty %}}判断循环体是否为空，for 没有continue和break；</p>
</li>
</ul>
<ul>
<li>forloop变量<br><code>forloop.counter</code> 从1计数的当前循环次数，<code>forloop.revcounter</code>，剩余的循环次数<code>forloop.counter0</code>，从0开始计数的循序。<br><code>forloop.first</code>和<code>forloop.last</code>,是否为第一次和最后一次循环，True 或False。</li>
</ul>
<h3 id="过滤器-filter"><a href="#过滤器-filter" class="headerlink" title="过滤器 filter"></a>过滤器 filter</h3><ul>
<li><p><code>|</code><br><code>{{book | upper | lower | capfisrt}}</code>,将变量book先变大写在变小写在变首字母大写<code>|</code>过滤器标识，类似于linux的管道，<br><code>{{today | date:"Y-m-d"}}</code>,today变量为<code>datetime.datetime.now()</code>。</p>
</li>
<li><p>自定义过滤器<br>模板自定义的过滤器位于 templatetags文件夹下，这是一个python包，里面要有一个空的<code>__init__</code>文件，一般一个过滤器函数为一个单独的py文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</div><div class="line">register = template.Library()</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">percent</span><span class="params">(value)</span>:</span></div><div class="line">    <span class="keyword">return</span> value + <span class="string">'%'</span></div><div class="line">register.filter(<span class="string">'percent'</span>,percent)</div></pre></td></tr></table></figure>
<p>过滤器必须用register对象注册，有2个参数，name和func，也可以在func处使用装饰器，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</div><div class="line">register = template.Library()</div><div class="line"></div><div class="line"><span class="meta">@register.filter(name='percent')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">percent</span><span class="params">(value)</span>:</span></div><div class="line">    <span class="keyword">return</span> value + <span class="string">'%'</span></div><div class="line"> <span class="comment">#register.filter('percent',percent)</span></div></pre></td></tr></table></figure>
<p>使用自定义过滤器时必须在模板中先load py文件，<code>{% load percent %}</code></p>
<p>需要重启服务器使过滤器生效</p>
</li>
</ul>

      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-08-15T16:00:00.000Z"><a href="/2016/08/16/技术/Django学习笔记2/">2016-08-16</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/08/16/技术/Django学习笔记2/">Django 学习笔记(二)</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Django进阶"><span class="toc-text">Django进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、用户信息扩展"><span class="toc-text">1、用户信息扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1、使用profile扩展"><span class="toc-text">1.1、使用profile扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2、继承AbstractUser"><span class="toc-text">1.2、继承AbstractUser</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、自定义认证"><span class="toc-text">2、自定义认证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1、自定义认证方式"><span class="toc-text">2.1、自定义认证方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2、session保持"><span class="toc-text">2.2、session保持</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、权限设计和使用"><span class="toc-text">3、权限设计和使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1、用户注册"><span class="toc-text">3.1、用户注册</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、自定义模板库"><span class="toc-text">4、自定义模板库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、自定义标签"><span class="toc-text">5、自定义标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6、自定义过滤器"><span class="toc-text">6、自定义过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7、model的定义和同步，增删改"><span class="toc-text">7、model的定义和同步，增删改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8、django单表查询和多表查询"><span class="toc-text">8、django单表查询和多表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9、聚合查询"><span class="toc-text">9、聚合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10、ORM无法满足查询需求时，直接使用SQL语句查询"><span class="toc-text">10、ORM无法满足查询需求时，直接使用SQL语句查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1、raw"><span class="toc-text">10.1、raw()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2、cursor"><span class="toc-text">10.2、cursor()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11、querysets和惰性机制"><span class="toc-text">11、querysets和惰性机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12、自定义manager管理器"><span class="toc-text">12、自定义manager管理器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#新增manager方法"><span class="toc-text">新增manager方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#改变原有的querySet方法"><span class="toc-text">改变原有的querySet方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13、Form表单"><span class="toc-text">13、Form表单</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#django开发实践技巧："><span class="toc-text">django开发实践技巧：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、从setting-py中读取配置信息为全局使用"><span class="toc-text">1、从setting.py中读取配置信息为全局使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、数据库模型设计技巧"><span class="toc-text">2、数据库模型设计技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、模板设计"><span class="toc-text">3、模板设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-、导航栏数据获取"><span class="toc-text">4 、导航栏数据获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、其他"><span class="toc-text">5、其他</span></a></li></ol></li></ol></li></ol>
    </div>

      
        <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#django%E8%BF%9B%E9%98%B6">Django进阶</a><ul>
<li><a href="#1%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%89%A9%E5%B1%95">1、用户信息扩展</a><ul>
<li><a href="#11%E4%BD%BF%E7%94%A8profile%E6%89%A9%E5%B1%95">1.1、使用profile扩展</a></li>
<li><a href="#12%E7%BB%A7%E6%89%BFabstractuser">1.2、继承AbstractUser</a></li>
</ul>
</li>
<li><a href="#2%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81">2、自定义认证</a><ul>
<li><a href="#21%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81%E6%96%B9%E5%BC%8F">2.1、自定义认证方式</a></li>
<li><a href="#22session%E4%BF%9D%E6%8C%81">2.2、session保持</a></li>
</ul>
</li>
<li><a href="#3%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E5%92%8C%E4%BD%BF%E7%94%A8">3、权限设计和使用</a><ul>
<li><a href="#31%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C">3.1、用户注册</a></li>
</ul>
</li>
<li><a href="#4%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF%E5%BA%93">4、自定义模板库</a></li>
<li><a href="#5%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE">5、自定义标签</a></li>
<li><a href="#6%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8">6、自定义过滤器</a></li>
<li><a href="#7model%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E5%90%8C%E6%AD%A5%E5%A2%9E%E5%88%A0%E6%94%B9">7、model的定义和同步，增删改</a></li>
<li><a href="#8django%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2">8、django单表查询和多表查询</a></li>
<li><a href="#9%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2">9、聚合查询</a></li>
<li><a href="#10orm%E6%97%A0%E6%B3%95%E6%BB%A1%E8%B6%B3%E6%9F%A5%E8%AF%A2%E9%9C%80%E6%B1%82%E6%97%B6%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8sql%E8%AF%AD%E5%8F%A5%E6%9F%A5%E8%AF%A2">10、ORM无法满足查询需求时，直接使用SQL语句查询</a><ul>
<li><a href="#101raw">10.1、raw()</a></li>
<li><a href="#102cursor">10.2、cursor()</a></li>
</ul>
</li>
<li><a href="#11querysets%E5%92%8C%E6%83%B0%E6%80%A7%E6%9C%BA%E5%88%B6">11、querysets和惰性机制</a></li>
<li><a href="#12%E8%87%AA%E5%AE%9A%E4%B9%89manager%E7%AE%A1%E7%90%86%E5%99%A8">12、自定义manager管理器</a><ul>
<li><a href="#%E6%96%B0%E5%A2%9Emanager%E6%96%B9%E6%B3%95">新增manager方法</a></li>
<li><a href="#%E6%94%B9%E5%8F%98%E5%8E%9F%E6%9C%89%E7%9A%84queryset%E6%96%B9%E6%B3%95">改变原有的querySet方法</a></li>
</ul>
</li>
<li><a href="#13form%E8%A1%A8%E5%8D%95">13、Form表单</a><ul>
<li><a href="#django%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5%E6%8A%80%E5%B7%A7">django开发实践技巧：</a></li>
</ul>
</li>
<li><a href="#1%E4%BB%8Esettingpy%E4%B8%AD%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%B8%BA%E5%85%A8%E5%B1%80%E4%BD%BF%E7%94%A8">1、从setting.py中读取配置信息为全局使用</a></li>
<li><a href="#2%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%8A%80%E5%B7%A7">2、数据库模型设计技巧</a></li>
<li><a href="#%E6%A8%A1%E6%9D%BF%E8%AE%BE%E8%AE%A1">模板设计</a></li>
<li><a href="#%E5%AF%BC%E8%88%AA%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96">导航数据获取</a></li>
<li><a href="#"></a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="Django进阶"><a href="#Django进阶" class="headerlink" title="Django进阶"></a>Django进阶</h1><h3 id="1、用户信息扩展"><a href="#1、用户信息扩展" class="headerlink" title="1、用户信息扩展"></a>1、用户信息扩展</h3><h4 id="1-1、使用profile扩展"><a href="#1-1、使用profile扩展" class="headerlink" title="1.1、使用profile扩展"></a>1.1、使用profile扩展</h4><p>在models定义一个profile表，使用外键关联</p>
<h4 id="1-2、继承AbstractUser"><a href="#1-2、继承AbstractUser" class="headerlink" title="1.2、继承AbstractUser"></a>1.2、继承AbstractUser</h4><p>在models创建继承AbstractUser的User类，为其增加新的字段，比如QQ号，手机号。在setting里设置字段 <code>AUTH_USER_MODEL = &#39;blog.User&#39;</code><br>在admin注册自己的User。</p>
<h3 id="2、自定义认证"><a href="#2、自定义认证" class="headerlink" title="2、自定义认证"></a>2、自定义认证</h3><h4 id="2-1、自定义认证方式"><a href="#2-1、自定义认证方式" class="headerlink" title="2.1、自定义认证方式"></a>2.1、自定义认证方式</h4><h4 id="2-2、session保持"><a href="#2-2、session保持" class="headerlink" title="2.2、session保持"></a>2.2、session保持</h4><h3 id="3、权限设计和使用"><a href="#3、权限设计和使用" class="headerlink" title="3、权限设计和使用"></a>3、权限设计和使用</h3><h4 id="3-1、用户注册"><a href="#3-1、用户注册" class="headerlink" title="3.1、用户注册"></a>3.1、用户注册</h4><h3 id="4、自定义模板库"><a href="#4、自定义模板库" class="headerlink" title="4、自定义模板库"></a>4、自定义模板库</h3><p>base文件和base.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">\&#123;\% block head_css \%\&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">继承扩展此处部分</span>&gt;</span></div><div class="line">\&#123;\% endblock \%\&#125;</div><div class="line">\&#123;\% block head_css \%\&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">继承扩展此处部分</span>&gt;</span></div><div class="line">\&#123;\% endblock \%\&#125;</div></pre></td></tr></table></figure>
<p>模板文件中引用base.html,重载里面需要定制的block，其他的继承base里默认的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">\&#123;\% extend "base/base.html" \%\&#125;</div><div class="line">\&#123;\% block container \%\&#125;</div><div class="line">实现部分</div><div class="line">\&#123;\% endblock \%\&#125;</div></pre></td></tr></table></figure>
<h3 id="5、自定义标签"><a href="#5、自定义标签" class="headerlink" title="5、自定义标签"></a>5、自定义标签</h3><p>在app目录下建立templatetags文件夹，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</div><div class="line"></div><div class="line">register = template.Library()</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpperNode</span><span class="params">(template.Node)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,nodelist)</span>:</span></div><div class="line">        self.nodelist = nodelist</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(self,context)</span>:</span></div><div class="line">        content = self.nodelist.render(context)</div><div class="line">        <span class="keyword">return</span> content.lower()</div><div class="line"></div><div class="line"><span class="meta">@register.tag</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upper</span><span class="params">(parse,token)</span>:</span></div><div class="line">    nodelist = parse.parse(<span class="string">"endupper"</span>)</div><div class="line">	parse.delete_first_token()</div><div class="line">    <span class="keyword">return</span> UpperNode(nodelist)</div></pre></td></tr></table></figure>
<p>在模板中加载使用自定义标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">\&#123;\% load upper \%\&#125;</div><div class="line">  \&#123;\% upper \%\&#125;</div><div class="line">     upper标签将作用于此块的内容</div><div class="line">  \&#123;\% endupper \%\&#125;</div></pre></td></tr></table></figure>
<h3 id="6、自定义过滤器"><a href="#6、自定义过滤器" class="headerlink" title="6、自定义过滤器"></a>6、自定义过滤器</h3><p>在templatetags下创建 assets.py,实现区分开发环境的assets资源定位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</div><div class="line"></div><div class="line">register = template.Library()</div><div class="line"><span class="keyword">from</span> blog.settings <span class="keyword">import</span> is_Debug</div><div class="line"><span class="meta">@register.filter</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">assets</span><span class="params">(value)</span>:</span></div><div class="line">    <span class="keyword">if</span> is_debug:</div><div class="line">        <span class="keyword">return</span> <span class="string">'/static/'</span>+value</div><div class="line">    <span class="keyword">return</span> <span class="string">'/static/assets/'</span> +value</div></pre></td></tr></table></figure>
<p>在模板中使用过滤器：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;% raw %&#125;</div><div class="line">&#123;% load assets %&#125;</div><div class="line"> <span class="tag">&lt;<span class="name">link</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;'1.css' | assets&#125;&#125;"</span>/&gt;</span></div><div class="line">&#123;% endraw %&#125;</div></pre></td></tr></table></figure>
<h3 id="7、model的定义和同步，增删改"><a href="#7、model的定义和同步，增删改" class="headerlink" title="7、model的定义和同步，增删改"></a>7、model的定义和同步，增删改</h3><p>在models.py中导入django.db 的models,<br>数据类定义：<br>在models.py中定义一个评论类<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">review</span><span class="params">(models.Model)</span>:</span></div><div class="line">    user = models.ForeignKey(User)</div><div class="line">    new = models.</div><div class="line">    content = models.TextField</div><div class="line">    creat_time =  models.DateTimeField()</div><div class="line">    is_dele = models.BoolenField(default = <span class="number">0</span>)</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">         <span class="keyword">return</span> self.content</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        permission = ()</div></pre></td></tr></table></figure></p>
<p>同步数据库:</p>
<p>增加数据：在视图views中导入数据类，比如user类，然后创建user对象的实例，然后调用save方法。<br>修改：先get实例，然后赋值修改，最后save</p>
<p>删除： 1、修改is_dele标志字段  2、删除数据实例，先获取实例。然后调用delete()方法</p>
<h3 id="8、django单表查询和多表查询"><a href="#8、django单表查询和多表查询" class="headerlink" title="8、django单表查询和多表查询"></a>8、django单表查询和多表查询</h3><p>ORM查询<br><img src="http://ww4.sinaimg.cn/large/af9df239gw1f8idjx7ki9j20h50bnt97.jpg" alt=""></p>
<p>多表查询用到外键</p>
<h3 id="9、聚合查询"><a href="#9、聚合查询" class="headerlink" title="9、聚合查询"></a>9、聚合查询</h3><p>Q协助查询，实现与或非。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</div><div class="line">res_list = news.objects.filter(Q(title = <span class="string">'today'</span>)|Q(body = <span class="string">'new'</span>))</div></pre></td></tr></table></figure></p>
<p><img src="http://ww3.sinaimg.cn/large/af9df239gw1f8ijt5ig9pj20k707ct94.jpg" alt=""></p>
<h3 id="10、ORM无法满足查询需求时，直接使用SQL语句查询"><a href="#10、ORM无法满足查询需求时，直接使用SQL语句查询" class="headerlink" title="10、ORM无法满足查询需求时，直接使用SQL语句查询"></a>10、ORM无法满足查询需求时，直接使用SQL语句查询</h3><h4 id="10-1、raw"><a href="#10-1、raw" class="headerlink" title="10.1、raw()"></a>10.1、raw()</h4><p> XXX.objects.raw(‘SQL 语句’)，但raw的SQL语句里，必须包含主键；对复杂语句支持不好</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">res_list = user.objects.raw(<span class="string">'select * from blog_user where id = 1 or sex = "女" '</span>)</div></pre></td></tr></table></figure>
<h4 id="10-2、cursor"><a href="#10-2、cursor" class="headerlink" title="10.2、cursor()"></a>10.2、cursor()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connection,transaction</div><div class="line">cursor = connection.cursor()</div><div class="line">sql = <span class="string">'select * from user'</span></div><div class="line">cursor.execute(sql)</div><div class="line">res_list = cursor.fetchall() <span class="comment">#每条记录是一个元组</span></div></pre></td></tr></table></figure>
<h3 id="11、querysets和惰性机制"><a href="#11、querysets和惰性机制" class="headerlink" title="11、querysets和惰性机制"></a>11、querysets和惰性机制</h3><p>querysets查询结果集，可以遍历，也可以继续执行查询筛选，<br><code>res_list = news.objects.filter(Q(title = &#39;today&#39;)|Q(body = &#39;new&#39;))</code></p>
<p>惰性机制：只有querysets被使用到，其数据查询才被执行，并返回结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">res_list = news.objects.filter(Q(title = <span class="string">'today'</span>)|Q(body = <span class="string">'new'</span>)) </div><div class="line">res_list.order_by(<span class="string">'age'</span>)</div><div class="line"></div><div class="line">res_dict = res_list.value(<span class="string">'id'</span>,<span class="string">'name'</span>)</div></pre></td></tr></table></figure>
<h3 id="12、自定义manager管理器"><a href="#12、自定义manager管理器" class="headerlink" title="12、自定义manager管理器"></a>12、自定义manager管理器</h3><p>当ORM的方法无法满足我们的需求时，</p>
<h4 id="新增manager方法"><a href="#新增manager方法" class="headerlink" title="新增manager方法"></a>新增manager方法</h4><p>类似<code>article.objects.all()</code>就是一个manager，用来获取数据的方法，我们可以定义自己的manager，<br>在models.py中新建类，继承models.Manager，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PollManager</span><span class="params">(models.Manager)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">with_counts</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">from</span> django.db <span class="keyword">import</span> connection</div><div class="line">        <span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cursor:</div><div class="line">            cursor.execute(<span class="string">""" SELECT p.id, p.question,p.poll_date, COUNT(*) FROM polls_opinionpoll p, polls_response r WHERE p.id = r.poll_id GROUP BY p.id, p.question, p.poll_date ORDER BY p.poll_date DESC"""</span>)</div><div class="line">        result_list = []</div><div class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall():</div><div class="line">            p = self.model(id=row[<span class="number">0</span>], question=row[<span class="number">1</span>],poll_date=row[<span class="number">2</span>])</div><div class="line">            p.num_responses = row[<span class="number">3</span>]</div><div class="line">            result_list.append(p)</div><div class="line">        <span class="keyword">return</span> result_list</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpinionPoll</span><span class="params">(models.Model)</span>:</span></div><div class="line">    question = models.CharField(max_length=<span class="number">200</span>)</div><div class="line">    poll_date = models.DateField()</div><div class="line">    objects = PollManager()</div></pre></td></tr></table></figure>
<p>然后就可以使用<code>OpinionPoll.objects.with_count()</code>方法</p>
<h4 id="改变原有的querySet方法"><a href="#改变原有的querySet方法" class="headerlink" title="改变原有的querySet方法"></a>改变原有的querySet方法</h4><p>覆盖重写原有方法。</p>
<h3 id="13、Form表单"><a href="#13、Form表单" class="headerlink" title="13、Form表单"></a>13、Form表单</h3><p>在views.py中定义form类：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span><span class="params">(forms.Form)</span></span></div><div class="line">    email = forms.CharField(label = 'email',max_length =100)</div><div class="line">    pwd = forms.CharField(label =<span class="string">'password'</span>,widget = forms.PasswordInput)</div><div class="line"><span class="comment">#添加验证</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_email</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> len(self.cleaned_data[<span class="string">"email"</span>].split(<span class="string">'@'</span>))&lt;<span class="number">2</span>:</div><div class="line">            <span class="keyword">raise</span> forms.ValidationError(<span class="string">'email is wrong!'</span>)</div><div class="line">         <span class="keyword">return</span> email</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="django开发实践技巧："><a href="#django开发实践技巧：" class="headerlink" title="django开发实践技巧："></a>django开发实践技巧：</h2><h3 id="1、从setting-py中读取配置信息为全局使用"><a href="#1、从setting-py中读取配置信息为全局使用" class="headerlink" title="1、从setting.py中读取配置信息为全局使用"></a>1、从setting.py中读取配置信息为全局使用</h3><p>settings中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#网站的基本信息配置</span></div><div class="line">SITE_URL = <span class="string">'http://localhost:8000/'</span></div><div class="line">SITE_NAME = <span class="string">'个人博客'</span></div><div class="line">SITE_DESC = <span class="string">'专注Python开发，欢迎和大家交流'</span></div><div class="line">WEIBO = <span class="string">'http://weibo.com/holdhiitfitness/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1'</span></div><div class="line">WEIBO_TENCENT = <span class="string">'http://weibo.com/holdhiitfitness/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1'</span></div><div class="line">PRO_RSS = <span class="string">'http://www.abroadrecommend.com'</span></div><div class="line">PRO_EMAIL = <span class="string">'johnson_hugh@163.com'</span></div><div class="line"><span class="comment"># 在templates中配置处理器</span></div><div class="line">TEMPLATES = [</div><div class="line">    &#123;</div><div class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.django.DjangoTemplates'</span>,</div><div class="line">        <span class="string">'DIRS'</span>: [</div><div class="line">            os.path.join(BASE_DIR,<span class="string">'templates'</span>),</div><div class="line">        ],</div><div class="line">        <span class="string">'APP_DIRS'</span>: <span class="keyword">True</span>,</div><div class="line">        <span class="string">'OPTIONS'</span>: &#123;</div><div class="line">            <span class="string">'context_processors'</span>: [</div><div class="line">                <span class="string">'django.template.context_processors.debug'</span>,</div><div class="line">                <span class="string">'django.template.context_processors.request'</span>,</div><div class="line">                <span class="string">'django.contrib.auth.context_processors.auth'</span>,</div><div class="line">                <span class="string">'django.contrib.messages.context_processors.messages'</span>,</div><div class="line">                <span class="string">'blog.views.global_setting'</span> <span class="comment"># 注意此处</span></div><div class="line">            ],</div><div class="line">        &#125;,</div><div class="line">    &#125;,</div><div class="line">]</div></pre></td></tr></table></figure>
<p>在 views中定义templates处理器的方法<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">globe_setting</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> &#123;<span class="string">'SITE_URL'</span>:settings.SITE_URL,</div><div class="line">            <span class="string">'SITE_NAME'</span>:settings.SITE_NAME</div><div class="line">             &#125;</div></pre></td></tr></table></figure></p>
<p>在模板文件中，可直接引用变量<code>{{SITE_URL}} </code></p>
<h3 id="2、数据库模型设计技巧"><a href="#2、数据库模型设计技巧" class="headerlink" title="2、数据库模型设计技巧"></a>2、数据库模型设计技巧</h3><p>使用工具 PowerDesign、ERWin、Visio、Navicat Data MOdeler</p>
<ul>
<li><p>分析可能存在的数据库表</p>
</li>
<li><p>分析可能会有的数据列，以及对应的数据类型和约束。</p>
</li>
<li><p>设计数据模型图</p>
<p>在modles.py中定义模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length =<span class="number">30</span>,verbose_name =<span class="string">'标签名称'</span>)</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span> <span class="comment"># 在admin管理界面可以看到</span></div><div class="line">        verbose_name = <span class="string">'标签'</span></div><div class="line">        verbose_name_plural = verbose_name</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span> <span class="comment">#print 对象时的输出</span></div><div class="line">        <span class="keyword">return</span> self.name</div><div class="line"><span class="comment"># 自定义User model</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(AbstactUser)</span>:</span></div><div class="line">    avatar = models.ImageField(upload_to =<span class="string">'url'</span>,default =<span class="string">'avatar/default.png'</span>,max_length =<span class="number">200</span>,)</div><div class="line">    QQ = models.CharField()</div></pre></td></tr></table></figure>
<p>自定义user model需要在setting中添加参数：<code>AUTH_USER_MODEL= &#39;blog.User&#39;</code><br>，可以继承abstactUser，或关联外键扩展。</p>
<p>mysql配置</p>
<p>settings:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="comment">#配置别忘了用逗号，否则不被识别为元组</span></div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'blogdb'</span>,</div><div class="line">        <span class="comment">#开发环境可用，生产环境不要用</span></div><div class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</div><div class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'123456'</span>,</div><div class="line">        <span class="string">'HOST'</span>: <span class="string">''</span>,</div><div class="line">        <span class="string">'PORT'</span>:  <span class="string">''</span>,<span class="comment">#默认3306</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在mysql中创建blogdb数据库，utf-8编码。</p>
<p>富文本编辑框：<br>使用kindeditor，下载kindeditor，解压文件放到/static/js/kindeditor 下面。<br>定义媒体文件 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Media</span>：</span></div><div class="line">     js = ('/static/js/kindeditor-4.10/kindeditor-min.js',</div><div class="line">           <span class="string">'/static/js/kindeditor-4.10/lang/zh-CN.js'</span>,</div><div class="line">           <span class="string">'/static/js/kindeditor-4.10/config.js'</span>,)</div></pre></td></tr></table></figure>
<p>注意新建配置文件config.js，参考官方文档：<br>K.create(‘#id’),#id 是对应html页面中需要富文本编辑器的网页元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">KindEditor.ready(<span class="function"><span class="keyword">function</span>(<span class="params">K</span>) </span>&#123;</div><div class="line">                K.create(<span class="string">'textarea[name=content]'</span>,&#123;</div><div class="line">                    width:<span class="string">'800px'</span>,</div><div class="line">                    height:<span class="string">'200px'</span>,</div><div class="line">                    <span class="comment">//配置上传地址，这个地址在url.py中已经配置好了，要和它对应</span></div><div class="line">                    uploadJson: <span class="string">'/admin/upload/kindeditor'</span>,</div><div class="line">                &#125;);</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>需要自己定义文件上传接口。<br>配置: 根目录下创建uploads，在settings中配置MEDIA_URL和MEDIA_ROOT</p>
</li>
<li><p>配置文件上传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#上传图片设置</span></div><div class="line">MEDIA_URL = <span class="string">'/uploads/'</span></div><div class="line">MEDIA_ROOT = os.path.join(BASE_DIR,<span class="string">'uploads'</span>)</div></pre></td></tr></table></figure>
<p>路由设置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#配置用于处理图片上传的url映射</span></div><div class="line">url(<span class="string">r"^uploads/(?P&lt;path&gt;.*)$"</span>, \</div><div class="line">                        <span class="comment">#django.views.static.serve专门用于处理静态文件</span></div><div class="line">     <span class="string">"django.views.static.serve"</span>, \</div><div class="line">                        <span class="comment">#这里用到了settings中配置好的路径MEDIA_ROOT</span></div><div class="line">     &#123;<span class="string">"document_root"</span>: settings.MEDIA_ROOT,&#125;),</div></pre></td></tr></table></figure>
</li>
<li><p>配置富文本编辑器的文件上传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> blog.upload <span class="keyword">import</span> upload_image</div><div class="line"></div><div class="line"><span class="comment">#用于映射富文本编辑器的图片上传</span></div><div class="line">url(<span class="string">r'^admin/upload/(?P&lt;dir_name&gt;[^/]+)$'</span>, upload_image,\</div><div class="line">        name=<span class="string">'upload_image'</span>),</div></pre></td></tr></table></figure>
<p>自己实现上传处理函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</div><div class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</div><div class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> uuid</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> datetime <span class="keyword">as</span> dt</div><div class="line"></div><div class="line"><span class="comment">#这个装饰器用于不再进行表单验证提交</span></div><div class="line"><span class="meta">@csrf_exempt</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_image</span><span class="params">(request, dir_name)</span>:</span></div><div class="line">    <span class="comment">##################</span></div><div class="line">    <span class="comment"># 这是kindeditor想要的格式</span></div><div class="line">    <span class="comment">#  kindeditor图片上传返回数据格式说明：</span></div><div class="line">    <span class="comment"># &#123;"error": 1, "message": "出错信息"&#125;</span></div><div class="line">    <span class="comment"># &#123;"error": 0, "url": "图片地址"&#125;</span></div><div class="line">    <span class="comment">##################</span></div><div class="line">    result = &#123;<span class="string">"error"</span>: <span class="number">1</span>, <span class="string">"message"</span>: <span class="string">"上传出错"</span>&#125;</div><div class="line">    <span class="comment">#imgFile来自于富文本编辑器查看源码之后找到的它定义的文件名字</span></div><div class="line">    files = request.FILES.get(<span class="string">"imgFile"</span>, <span class="keyword">None</span>)</div><div class="line">    <span class="keyword">if</span> files:</div><div class="line">        result =image_upload(files, dir_name)</div><div class="line">    <span class="keyword">return</span> HttpResponse(json.dumps(result), content_type=<span class="string">"application/json"</span>)</div><div class="line"></div><div class="line"><span class="comment">#目录创建</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_generation_dir</span><span class="params">(dir_name)</span>:</span></div><div class="line">    today = dt.datetime.today()</div><div class="line">    dir_name = dir_name + <span class="string">'/%d/%d/'</span> %(today.year,today.month)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(settings.MEDIA_ROOT + dir_name):</div><div class="line">        os.makedirs(settings.MEDIA_ROOT + dir_name)</div><div class="line">    <span class="keyword">return</span> dir_name</div><div class="line"></div><div class="line"><span class="comment"># 图片上传</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">image_upload</span><span class="params">(files, dir_name)</span>:</span></div><div class="line">    <span class="comment">#允许上传文件类型</span></div><div class="line">    allow_suffix =[<span class="string">'jpg'</span>, <span class="string">'png'</span>, <span class="string">'jpeg'</span>, <span class="string">'gif'</span>, <span class="string">'bmp'</span>]</div><div class="line">    file_suffix = files.name.split(<span class="string">"."</span>)[<span class="number">-1</span>]</div><div class="line">    <span class="keyword">if</span> file_suffix <span class="keyword">not</span> <span class="keyword">in</span> allow_suffix:</div><div class="line">        <span class="keyword">return</span> &#123;<span class="string">"error"</span>: <span class="number">1</span>, <span class="string">"message"</span>: <span class="string">"图片格式不正确"</span>&#125;</div><div class="line">    relative_path_file = upload_generation_dir(dir_name)</div><div class="line">    path=os.path.join(settings.MEDIA_ROOT, relative_path_file)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path): <span class="comment">#如果目录不存在创建目录</span></div><div class="line">        os.makedirs(path)</div><div class="line">    file_name=str(uuid.uuid1())+<span class="string">"."</span>+file_suffix</div><div class="line">    path_file=os.path.join(path, file_name)</div><div class="line">    file_url = settings.MEDIA_URL + relative_path_file + file_name</div><div class="line">    <span class="comment">#写入操作，二进制形式，最终完成上传，真正保存图片</span></div><div class="line">    open(path_file, <span class="string">'wb'</span>).write(files.file.read())</div><div class="line">    <span class="keyword">return</span> &#123;<span class="string">"error"</span>: <span class="number">0</span>, <span class="string">"url"</span>: file_url&#125;</div></pre></td></tr></table></figure>
<p>配置好路由，在kindeditor的config js中配置上传路径：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">KindEditor.ready(<span class="function"><span class="keyword">function</span>(<span class="params">K</span>) </span>&#123;</div><div class="line">                K.create(<span class="string">'textarea[name=content]'</span>,&#123;</div><div class="line">                    width:<span class="string">'800px'</span>,</div><div class="line">                    height:<span class="string">'200px'</span>,</div><div class="line">                    <span class="comment">//配置上传地址，这个地址在url.py中已经配置好了，要和它对应</span></div><div class="line">                    uploadJson: <span class="string">'/admin/upload/kindeditor'</span>,</div><div class="line">                &#125;);</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h3 id="3、模板设计"><a href="#3、模板设计" class="headerlink" title="3、模板设计"></a>3、模板设计</h3><p>base.html保留不变的内容，变化的部分以<code>\{\% block XXX \%\} \{\% endblock \%\}</code>代替，<br>子模板继承 <code>base.html</code>,<code>\{\% extends &#39;base.html&#39;}</code>,然后重写<code>\{\% block XXX \%\} \{\% endblock \%\}</code>，在{\% block XXX \%} 中间添加变化的内容 {\% endblock \%}。<br>也可将变化的部分单独放入一个文件中，使用 <code>\{\% include &#39;XXX.html&#39; \%\}</code></p>
<h3 id="4-、导航栏数据获取"><a href="#4-、导航栏数据获取" class="headerlink" title="4 、导航栏数据获取"></a>4 、导航栏数据获取</h3><p>假如以category模型设计导航栏，先获取对象列表，传递变量给模板，然后在模板中展示<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># views 中</span></div><div class="line"><span class="keyword">from</span> models <span class="keyword">import</span> *</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span><span class="params">(request)</span>：</span></div><div class="line">     ca_list = category.objects.all()</div><div class="line">     <span class="keyword">return</span> render(request,<span class="string">'base.html'</span>,&#123;<span class="string">'ca_list'</span>:ca_list&#125;)</div></pre></td></tr></table></figure></p>
<p>在模板中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;% raw %&#125;</div><div class="line">&#123;% for ca in ca_list %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">herf</span> =<span class="string">''</span>&gt;</span>&#123;&#123;ca.name&#125;&#125; <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">&#123;% endfor %&#125;</div><div class="line">&#123;% endraw %&#125;</div></pre></td></tr></table></figure>
<h3 id="5、其他"><a href="#5、其他" class="headerlink" title="5、其他"></a>5、其他</h3><ul>
<li><p>locals() 将所有变量封装传递进模板，<br><code>render(&#39;index.html&#39;,locals())</code></p>
</li>
<li><p>代码重构：使用模板处理器，<br>上面的global_setting的例子，将每个视图都用到的模板变量数据定义到模板处理器中。</p>
</li>
<li><p>聚合查询</p>
<p>annotate</p>
</li>
<li><p>异常捕获</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> ：</div><div class="line">    get_article()</div><div class="line"><span class="keyword">except</span> Artical.NotExist:</div><div class="line">    xxx</div></pre></td></tr></table></figure>
</li>
<li><p>标签过滤器</p>
<p><code> {{update_date|date:'Y-m-d'}}</code><br>safe 不转义变量文本里的html便签，确定变量安全的可以用该过滤器。</p>
</li>
<li><p>csrf表单验证</p>
<p>模板页面表单处需要 <code>\{\% csrf_token \%\}</code>,防止跨站提交的安全手段。</p>
<p>不使用csrf(不推荐)，post方法使用csrf_exmp装饰器。</p>
</li>
</ul>

      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-08-12T16:00:00.000Z"><a href="/2016/08/13/技术/django学习笔记1/">2016-08-13</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/08/13/技术/django学习笔记1/">Django 学习笔记(一)</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Django-学习笔记1"><span class="toc-text">Django 学习笔记1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、快速开始"><span class="toc-text">1、快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1、创建项目"><span class="toc-text">1.1、创建项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2、创建应用"><span class="toc-text">1.2、创建应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3、-Django-Admin"><span class="toc-text">1.3、 Django Admin</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、记录踩过的坑"><span class="toc-text">2、记录踩过的坑</span></a></li></ol></li></ol></li></ol>
    </div>

      
        <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#django-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">Django 学习笔记</a><ul>
<li><a href="#1%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">1、快速开始</a><ul>
<li><a href="#11%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE">1.1、创建项目</a></li>
<li><a href="#12%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8">1.2、创建应用</a></li>
<li><a href="#13-django-admin">1.3、 Django Admin</a></li>
</ul>
</li>
<li><a href="#2%E8%AE%B0%E5%BD%95%E8%B8%A9%E8%BF%87%E7%9A%84%E5%9D%91">2、记录踩过的坑</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="Django-学习笔记1"><a href="#Django-学习笔记1" class="headerlink" title="Django 学习笔记1"></a>Django 学习笔记1</h1><blockquote>
<p>基于python2.7和django1.10</p>
</blockquote>
<p>django工作流程：<br><img src="http://ww3.sinaimg.cn/large/af9df239gw1f8gckh77jrj20hm0c2dgy.jpg" alt=""></p>
<h3 id="1、快速开始"><a href="#1、快速开始" class="headerlink" title="1、快速开始"></a>1、快速开始</h3><h4 id="1-1、创建项目"><a href="#1-1、创建项目" class="headerlink" title="1.1、创建项目"></a>1.1、创建项目</h4><ul>
<li><p>django-admin.py startproject website</p>
</li>
<li><p>manage.py startapp blog</p>
</li>
<li><p>修改webisite下的setting.py urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># setting 修改</span></div><div class="line"><span class="comment"># installed_apps 添加你的app</span></div><div class="line"><span class="comment">#To include the app in our project, we need to add a reference to its configuration class in the INSTALLED_APPS setting. The PollsConfigclass is in the polls/apps.pyfile, so its dotted pathis ’blog.apps.PollsConfig’. Edit the mysite/settings.pyfile and add that dotted path to the INSTALLED_APPSsetting.</span></div><div class="line"></div><div class="line">INSTALLED_APPS = [...XXX...,</div><div class="line">				’blog.apps.PollsConfig’,</div><div class="line">                ]</div><div class="line"></div><div class="line">language zh-HANS</div><div class="line">time-zone zh/Shanghai</div><div class="line"><span class="comment"># 数据库连接配置</span></div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># website/urls.py修改</span></div><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include, url <span class="comment"># 注意导入include</span></div><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line">urlpatterns = [</div><div class="line">  url(<span class="string">r'^blog/'</span>, include(<span class="string">'blog.urls'</span>)), <span class="comment"># include app的urls规则</span></div><div class="line">  url(<span class="string">r'^admin/'</span>, admin.site.urls), <span class="comment"># 只有admin例外，可以不用include</span></div><div class="line">]</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h4 id="1-2、创建应用"><a href="#1-2、创建应用" class="headerlink" title="1.2、创建应用"></a>1.2、创建应用</h4><ul>
<li><p>manage.py startapp blog</p>
</li>
<li><p>创建视图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 编辑文件 blog/views.py</span></div><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></div><div class="line"><span class="keyword">return</span> HttpResponse(<span class="string">"Hello, world. You're at the polls index."</span>)</div></pre></td></tr></table></figure>
<p>views可以获取url中的参数作为变量使用：<br><code>url(r&#39;^(?P&lt;question_id&gt;[0-9]+)/vote/$&#39;, views.vote, name=&#39;vote&#39;)</code>,<br>通过urls中的正则表达式匹配的命名变量: <code>%question_id</code></p>
</li>
</ul>
<ul>
<li><p>view视图模板</p>
<p>模板文件存放在 <code>app/templates/app/</code>下。<br>在view文件中加载渲染的模板：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</div><div class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</div><div class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></div><div class="line">latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</div><div class="line">template = loader.get_template(<span class="string">'polls/index.html'</span>)</div><div class="line">context = &#123;</div><div class="line"><span class="string">'latest_question_list'</span>: latest_question_list,</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> HttpResponse(template.render(context, request))</div></pre></td></tr></table></figure>
<p>或直接使用render()函数渲染,这样就不用Httpresponse和loader了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</div><div class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></div><div class="line">latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</div><div class="line">context = &#123;<span class="string">'latest_question_list'</span>: latest_question_list&#125;</div><div class="line"><span class="keyword">return</span> render(request, <span class="string">'blog/index.html'</span>, context)</div></pre></td></tr></table></figure>
</li>
<li><p>模板中的url软编码<br>在urls.py中每个url匹配规则可以指定一个name参数。在模板中使用<code>{% url 'name'  %}</code>引用URL，</p>
<p>e.g. <code><li><a href="{% url 'detail' question.id %}">{{ question.question_text }} </a></li> </code></p>
<p>这样，当url映射改变时，无需修改模板文件。<br>当app很多时，在urls.py中指定url命名空间，即app_name=’XXX’,然后模板引用url时，使用<code>{% url 'blog:detail' question_id %}</code></p>
</li>
<li><p>模板中的表单和view中对表单数据的处理</p>
</li>
</ul>
<ul>
<li><p>404视图<br>使用try catch或get_XXX_or_404方法，推荐后者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>: </div><div class="line">       question = Question.objects.get(pk = question_id)</div><div class="line">   <span class="keyword">except</span> Question.DoesNotExist:</div><div class="line">       <span class="keyword">raise</span> Http404(<span class="string">"Questin does not exist!"</span>)</div><div class="line">   <span class="keyword">return</span> render(request, <span class="string">'blog/detail.html'</span>, context=&#123;<span class="string">'question'</span>:question&#125;)</div><div class="line">   <span class="comment">### 或者 no use try ,we can do this :</span></div><div class="line">   </div><div class="line">   question = get_object_or_404(Question, pk=question_id)</div><div class="line">   <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>使用generic views</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> generic</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span><span class="params">(generic.ListView)</span>:</span></div><div class="line">    template_name = <span class="string">'blog/index.html'</span></div><div class="line">    context_object_name = <span class="string">'latest_question_list'</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""Return the last five published questions."""</span></div><div class="line">        <span class="keyword">return</span> Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>url映射规则</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#编辑 blog/urls.py</span></div><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</div><div class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</div><div class="line">urlpatterns = [</div><div class="line">url(<span class="string">r'^$'</span>, views.index, name=<span class="string">'index'</span>),</div><div class="line">]</div><div class="line"><span class="comment"># name参数可以在模板文件中以&#123;% raw %&#125;&#123;% url name %&#125;&#123;% endraw %&#125; 引用。</span></div><div class="line"><span class="comment"># 然后将其include到website下的urls.py内</span></div></pre></td></tr></table></figure>
</li>
<li><p>数据库设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#修改settings.py，配置数据库连接</span></div><div class="line"><span class="comment"># 然后执行命令创建数据库</span></div><div class="line">manage.py migrate</div></pre></td></tr></table></figure>
</li>
<li><p>创建模式</p>
<p>编辑 blog/models.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></div><div class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</div><div class="line">	pub_date = models.DateTimeField(<span class="string">'date published'</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></div><div class="line">	question = models.ForeignKey(Question,on_delete=models.CASCADE)</div><div class="line">	choice_text = models.CharField(max_length=<span class="number">200</span>)</div><div class="line">	votes = models.IntegerField(default=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p>激活models，执行<code>manage.py makemigrations blog</code>，最后应用到数据库，<code>manage migrate</code>。</p>
<p>总结：<br>• Change your models (in models.py).<br>• Run python manage.py makemigrations to create migrations for those changes<br>• Run python manage.py migrate to apply those changes to the database.</p>
</li>
<li><p>views中引用数据库中的数据</p>
<p>获得全部对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</div><div class="line"></div><div class="line">question_list =  Question.object.all()</div><div class="line">l1=Question.objects.filter(question_text = <span class="string">u'what 你好'</span>) <span class="comment"># 对象数据过滤器，等于</span></div><div class="line">Question.objects.filter( age__gt = <span class="number">16</span>) <span class="comment"># 属性age &gt; 16</span></div><div class="line">Question.objects.filter( age__gte = <span class="number">16</span>) <span class="comment"># 属性age &gt;= 16</span></div><div class="line">Question.objects.filter( name__contains = <span class="string">'张'</span>) <span class="comment"># 属性name中含有张。</span></div><div class="line"><span class="comment"># 批量更新,无需调用save</span></div><div class="line">Question.objects.filter( age__gt = <span class="number">16</span>).update(name = <span class="string">'zhang'</span>)</div><div class="line"><span class="comment"># 删除调用.delete()方法</span></div></pre></td></tr></table></figure>
<p>filter过滤表达式</p>
<p><img src="http://ww3.sinaimg.cn/large/af9df239gw1f8gandhuixj20kn0863zr.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ques = Question.object.get(id = <span class="number">2</span>)</div><div class="line">ques.name = <span class="string">'a'</span></div><div class="line">ques.date = today</div><div class="line">ques.save() <span class="comment">#同步修改</span></div><div class="line"><span class="comment"># 删除调用.delete()方法</span></div><div class="line">ques.delete()</div></pre></td></tr></table></figure>
<p>获得单个对象</p>
<p>添加一个新对象数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">newQ = Question(name = <span class="string">'new'</span>,age =<span class="number">16</span>)</div><div class="line">newQ.save()</div></pre></td></tr></table></figure>
</li>
<li><p>实现实体对应关系一对一和多对多</p>
<p>待补充</p>
</li>
</ul>
<h4 id="1-3、-Django-Admin"><a href="#1-3、-Django-Admin" class="headerlink" title="1.3、 Django Admin"></a>1.3、 Django Admin</h4><ul>
<li><p>create admin user</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">python manage.py createsuperuser</div><div class="line">name:admin</div><div class="line">mail:</div><div class="line">password:****</div></pre></td></tr></table></figure>
<p>​启动server,访问 <a href="http://127.0.0.1:8000/admin/" target="_blank" rel="external">http://127.0.0.1:8000/admin/</a></p>
</li>
<li><p>在admin界面注册app 的object</p>
<p>打开的admin管理界面默认是没有blog app数据的<br>编辑 blog/admin.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line"><span class="comment"># Register your models here.</span></div><div class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</div><div class="line">admin.site.register(Question)</div></pre></td></tr></table></figure>
</li>
<li><p>个性化 app</p>
<p>static文件夹，blog\static\blog\ 下存放css文件，模板文件中引用css和图片使用相对路径。</p>
<p>blog\static\blog\images\下存放图片文件，css中和模板中引用图片使用相对路径。</p>
</li>
<li><p>django favicon.ico </p>
<p>处理：<a href="https://pypi.python.org/pypi/django-favicon" target="_blank" rel="external">https://pypi.python.org/pypi/django-favicon</a></p>
</li>
<li><p>从url传值</p>
<ol>
<li>get</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">id = request.GET[<span class="string">'id'</span>]</div><div class="line">passwd = request.POST[<span class="string">'password'</span>]</div></pre></td></tr></table></figure>
<ol>
<li>/argv1/argv2/…</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">views.py</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">wanda</span><span class="params">(request,wanda)</span>:</span></div><div class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">r' `&lt;h4&gt; %s  &lt;/h4&gt;`'</span> % wanda)</div><div class="line"></div><div class="line">urls.py</div><div class="line">url(<span class="string">r'wanda/(?P&lt;wanda&gt;\d&#123;4&#125;)/$'</span>,views.wanda),</div></pre></td></tr></table></figure>
<p>其中变量wanda是在url正则表达式中定义的分组变量名称。<br>如果不定义<code>?P&lt;name&gt;</code>,则在view视图函数中可以传入任意变量名，按对应顺序从URL匹配中取值。</p>
</li>
</ul>
<h3 id="2、记录踩过的坑"><a href="#2、记录踩过的坑" class="headerlink" title="2、记录踩过的坑"></a>2、记录踩过的坑</h3><ol>
<li><p>object has no attribute ‘_state’：</p>
<p>django不使用init方法，参考文档creating-objects部分。</p>
</li>
<li><p>IOError: No translation files found for default language zh-CN. </p>
<p>经确认是新版本的django包版本中只有zh_Hans目录，没有zh_CN,把zh_Hans目录复制一个zh_CN就Ok了<br>或者在settings里面直接改成zh-Hans，这样就不用升级完Django，还去改目录了。</p>
</li>
<li><p>debug=False后，网站无法访问静态资源图片等</p>
<p>需要在启动参数中添加insecure <code>manage runserver 0.0.0.0:8080 --insecure</code></p>
</li>
</ol>

      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-08-09T16:00:00.000Z"><a href="/2016/08/10/技术/PhantomJS + Selenium实现登陆网站签到/">2016-08-10</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/08/10/技术/PhantomJS + Selenium实现登陆网站签到/">PhantomJS + Selenium实现登陆网站签到</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#PhantomJS-Selenium实现登陆网站签到"><span class="toc-text">PhantomJS + Selenium实现登陆网站签到</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#目标网站分析"><span class="toc-text">目标网站分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#签到脚本"><span class="toc-text">签到脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用requests模拟签到"><span class="toc-text">使用requests模拟签到</span></a></li></ol></li></ol>
    </div>

      
        <h3 id="PhantomJS-Selenium实现登陆网站签到"><a href="#PhantomJS-Selenium实现登陆网站签到" class="headerlink" title="PhantomJS + Selenium实现登陆网站签到"></a>PhantomJS + Selenium实现登陆网站签到</h3><blockquote>
<p>js脚本是由浏览器前端加载执行的，因此爬虫要想渲染js，就要实现js引擎，或者我们分析出js发送的请求后，自己构造(很难，复杂)。</p>
<p>另外一种，就是使用selenium调用浏览器自动化处理。phantomjs是一个无头浏览器，没有界面，因此运行速度要比chrome快一点，没有弹窗干扰。</p>
<p>requests，urllib之类的http库，只能将http资源请求下来，其中的img link js标签都不会自动加载。而浏览器会请求所有的资源。</p>
</blockquote>
<h4 id="目标网站分析"><a href="#目标网站分析" class="headerlink" title="目标网站分析"></a>目标网站分析</h4><p><img src="http://ww1.sinaimg.cn/large/af9df239gw1fb3128aq8aj20do0ak0t0.jpg" alt=""></p>
<p>网站<code>yrw.com</code>,登陆后签到页面是一个js脚本控制的插件,ipinyou.com估计是显示签到效果的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"> &lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="keyword">var</span> _py = _py || [];</div><div class="line">    <span class="keyword">var</span> _userId = <span class="string">"0"</span>;</div><div class="line">    <span class="keyword">var</span> _source = <span class="string">"0"</span>;</div><div class="line">    <span class="keyword">var</span> _pv = <span class="string">"0"</span>;</div><div class="line">    _py.push([<span class="string">'a'</span>, <span class="string">'qJ..OIEiS_boFsG_SD2lEUB5nX'</span>]);</div><div class="line">    _py.push([<span class="string">'domain'</span>, <span class="string">'stats.ipinyou.com'</span>]);</div><div class="line">    _py.push([<span class="string">'e'</span>, <span class="string">"&#123;\"userId\":\""</span> + _userId + <span class="string">"\",\"source\":\""</span> + _source + <span class="string">"\"&#125;"</span>]);</div><div class="line">    _py.push([<span class="string">'pv'</span>, _pv]);</div><div class="line">    -<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> s = d.createElement(<span class="string">'script'</span>),</div><div class="line">                e = <span class="built_in">document</span>.body.getElementsByTagName(<span class="string">'script'</span>)[<span class="number">0</span>];</div><div class="line">        e.parentNode.insertBefore(s, e),</div><div class="line">                f = <span class="string">'https:'</span> == location.protocol;</div><div class="line">        s.src = (f ? <span class="string">'https'</span> : <span class="string">'http'</span>) + <span class="string">'://'</span> + (f ? <span class="string">'fm.ipinyou.com'</span> : <span class="string">'fm.p0y.cn'</span>) + <span class="string">'/j/adv.js'</span>;</div><div class="line">    &#125;(<span class="built_in">document</span>);</div><div class="line">&lt;<span class="regexp">/script&gt;</span></div><div class="line"><span class="regexp">&lt;noscript&gt;</span></div><div class="line"><span class="regexp">    &lt;img src="/</span><span class="regexp">/stats.ipinyou.com/</span>adv.gif?a=qJ..OIEiS_boFsG_SD2lEUB5nX&amp;e=<span class="string">" style="</span>display:none;<span class="string">"/&gt;</span></div><div class="line"><span class="string">&lt;/noscript&gt;</span></div></pre></td></tr></table></figure>
<p>最初用fiddler抓包，发现请求的链接很复杂，不好构造，于是决定用selenium操作浏览器。后来用Chrome的XHR发现了请求链接，囧。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Request-Headers:</div><div class="line">GET /member/check/?_=1482648421735 HTTP/1.1</div><div class="line">Host: www.yrw.com</div><div class="line">Connection: keep-alive</div><div class="line">Accept: application/json, text/javascript, */*; q=0.01</div><div class="line">X-Requested-With: XMLHttpRequest</div><div class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.87 Safari/537.36</div><div class="line">Referer: https://www.yrw.com/member/home</div><div class="line">Accept-Encoding: gzip, deflate, sdch, br</div><div class="line">Accept-Language: zh-CN,zh;q=0.8</div><div class="line">Cookie: JSESSIONID=99ED09E3560F9F944EEAE855532F8684; CNZZDATA1253600367=1638558785-1463053615-%7C1482644670</div><div class="line"></div><div class="line">Request-url:</div><div class="line">https://www.yrw.com/member/check/?_=1482648421735</div><div class="line"></div><div class="line">Response-json:</div><div class="line">&#123;&quot;error&quot;:false,&quot;page&quot;:null,&quot;result&quot;:&#123;&quot;checkDate&quot;:1482648441429,&quot;checkSource&quot;:0,&quot;createTime&quot;:null,&quot;gainPopularity&quot;:2,&quot;id&quot;:null,&quot;memberId&quot;:110850411330,&quot;popularityDouble&quot;:1&#125;,&quot;resultCode&quot;:null,&quot;resultCodeEum&quot;:null,&quot;resultCodeList&quot;:[],&quot;resultList&quot;:null,&quot;success&quot;:true&#125;</div></pre></td></tr></table></figure>
<h4 id="签到脚本"><a href="#签到脚本" class="headerlink" title="签到脚本"></a>签到脚本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf-8</span></div><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">import</span> time  <span class="comment"># 要注意等待浏览器加载页面完成</span></div><div class="line"></div><div class="line"></div><div class="line">browser = webdriver.PhantomJS(executable_path=<span class="string">r"E:\C\python\py\pantomjs_selenuim\bin\phantomjs.exe"</span>)</div><div class="line">url = <span class="string">r'http://www.yrw.com/'</span></div><div class="line">a = browser.get(url)</div><div class="line">login_url = <span class="string">r'http://www.yrw.com/security/login/'</span></div><div class="line">browser.get(login_url)</div><div class="line">username= browser.find_elements_by_id(<span class="string">'j-cpn2'</span>)  <span class="comment"># find_elements方法返回的列表， find_element返回找到的第一个</span></div><div class="line">passwd=browser.find_elements_by_name(<span class="string">'password'</span>)</div><div class="line">submit = browser.find_elements_by_id(<span class="string">'j-login-submit'</span>)</div><div class="line">username[<span class="number">0</span>].send_keys(<span class="string">'username'</span>)  <span class="comment"># 填用户名</span></div><div class="line">passwd[<span class="number">0</span>].send_keys(<span class="string">'password'</span>)  <span class="comment"># 填密码</span></div><div class="line">submit[<span class="number">0</span>].click() <span class="comment"># 点击登陆按钮</span></div><div class="line">time.sleep(<span class="number">5</span>)</div><div class="line">page1 = browser.page_source</div><div class="line">browser.save_screenshot(<span class="string">'login.jpg'</span>)</div><div class="line">browser.find_element_by_id(<span class="string">"j-checkin-btn"</span>).click()</div><div class="line">time.sleep(<span class="number">5</span>)</div><div class="line">page2 = browser.page_source  <span class="comment"># 打印网页源码</span></div><div class="line">browser.save_screenshot(<span class="string">'sign.jpg'</span>)</div><div class="line">browser.quit()  <span class="comment"># 关闭phantom浏览器</span></div><div class="line"><span class="keyword">print</span> <span class="number">1</span></div></pre></td></tr></table></figure>
<h4 id="使用requests模拟签到"><a href="#使用requests模拟签到" class="headerlink" title="使用requests模拟签到"></a>使用requests模拟签到</h4><blockquote>
<p>找到了js请求的url：<a href="https://www.yrw.com/member/check/?_=1482648421735" target="_blank" rel="external">https://www.yrw.com/member/check/?_=1482648421735</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 主要是想验证签到的url是否正确，登陆部分直接用的cookie，模拟登陆也很简单，post登陆表单即可，无验证码</span></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"></div><div class="line">sign_url = <span class="string">r'https://www.yrw.com/member/check/?_=1482648421735'</span> <span class="comment"># 数字含义应该是时间戳，不影响url访问</span></div><div class="line">cookie_string = <span class="string">r'JSESSIONID=6F98E86EBE571D3233EE14B986320E86; CNZZDATA1253600367=1638558785-1463053615-%7C1482717076'</span></div><div class="line">headers = &#123;</div><div class="line"> 	 <span class="string">'Host'</span>: <span class="string">'www.yrw.com'</span>,</div><div class="line">	 <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</div><div class="line">	<span class="string">'Accept'</span>: <span class="string">'application/json, text/javascript, */*; q=0.01'</span>,</div><div class="line">	<span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</div><div class="line">	<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.87 Safari/537.36'</span>,</div><div class="line">	<span class="string">'Referer'</span>: <span class="string">'https://www.yrw.com/member/home'</span>,</div><div class="line">	<span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate, sdch, br'</span>,</div><div class="line">	<span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.8'</span>,</div><div class="line">	<span class="string">'Cookie'</span>: cookie_string</div><div class="line">&#125;</div><div class="line">s = requests.Session()</div><div class="line">s.headers = headers</div><div class="line">response = s.get(sign_url)</div><div class="line">q = response.json()</div><div class="line"><span class="keyword">if</span> q[<span class="string">'success'</span>]:</div><div class="line">    <span class="keyword">print</span> <span class="string">u'签到成功,获得积分%d点'</span> % q[<span class="string">'result'</span>][<span class="string">'gainPopularity'</span>]</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="keyword">print</span> <span class="string">u'签到失败'</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
		
          <time datetime="2016-08-08T16:00:00.000Z"><a href="/2016/08/09/技术/python2爬虫笔记/">2016-08-09</a></time>
        
	  
      
  
    <h1 class="title"><a href="/2016/08/09/技术/python2爬虫笔记/">爬虫笔记(基于python2)</a></h1>
  

    </header>
    <div class="entry">
         
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#urllib2库的用法"><span class="toc-text">urllib2库的用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基础用法"><span class="toc-text">基础用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#高级用法"><span class="toc-text">高级用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cookie保持登陆"><span class="toc-text">cookie保持登陆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实例"><span class="toc-text">实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#URLError异常处理"><span class="toc-text">URLError异常处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#正则表达式-和-bs4"><span class="toc-text">正则表达式 和 bs4</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#正则表达式"><span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用匹配"><span class="toc-text">常用匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BeautifulSoup"><span class="toc-text">BeautifulSoup</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Requests库的用法"><span class="toc-text">Requests库的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xpath语法与lxml库"><span class="toc-text">xpath语法与lxml库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xpath语法"><span class="toc-text">xpath语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lxml用法"><span class="toc-text">lxml用法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PhantomJS的用法"><span class="toc-text">PhantomJS的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Selenium的用法"><span class="toc-text">Selenium的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PyQuery的用法"><span class="toc-text">PyQuery的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PySpider框架"><span class="toc-text">PySpider框架</span></a></li></ol>
    </div>

      
        <blockquote>
<p>基于python2.7</p>
</blockquote>
<h3 id="urllib2库的用法"><a href="#urllib2库的用法" class="headerlink" title="urllib2库的用法"></a>urllib2库的用法</h3><h4 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h4><ul>
<li>urlopen方法打开网页</li>
</ul>
<p>传入3个参数，data和timeout不是必须的；返回网页的源码可用read方法读出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">response = urlopen(url,data,timeout)</div><div class="line">content = response.read()</div></pre></td></tr></table></figure>
<p>urlopen()本质上接收一个request对象，返回response对象。<br>构建request对象：request = urllib2.Request(url, data=None, headers={}, origin_req_host=None, unverifiable=False)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">import urllib2</div><div class="line"></div><div class="line">request = urllib2.Request(&quot;http://www.baidu.com&quot;)</div><div class="line">response = urllib2.urlopen(request)</div><div class="line">print response.read()</div></pre></td></tr></table></figure>
<ul>
<li>post方式请求数据</li>
</ul>
<p>post提交的数据不会在网址中显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">import urllib</div><div class="line">import urllib2</div><div class="line"></div><div class="line">values = &#123;&quot;username&quot;:&quot;xxxx@qq.com&quot;,&quot;password&quot;:&quot;XXXX&quot;&#125;</div><div class="line">data = urllib.urlencode(values) </div><div class="line">url = &quot;https://passport.csdn.net/account/login?from=http://my.csdn.net/my/mycsdn&quot;</div><div class="line">request = urllib2.Request(url,data)</div><div class="line">response = urllib2.urlopen(request)</div><div class="line">print response.read()</div></pre></td></tr></table></figure>
<ul>
<li>get方式请求数据</li>
</ul>
<p>get方式提高的数据直接包含在网址当中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">import urllib</div><div class="line">import urllib2</div><div class="line"></div><div class="line">values=&#123;&#125;</div><div class="line">values[&apos;username&apos;] = &quot;1016903103@qq.com&quot;</div><div class="line">values[&apos;password&apos;]=&quot;XXXX&quot;</div><div class="line">data = urllib.urlencode(values) </div><div class="line">url = &quot;http://passport.csdn.net/account/login&quot;</div><div class="line">   ### 数据拼接到url中</div><div class="line">geturl = url + &quot;?&quot;+data </div><div class="line">request = urllib2.Request(geturl)</div><div class="line">response = urllib2.urlopen(request)</div><div class="line">print response.read()</div></pre></td></tr></table></figure>
<h4 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h4><blockquote>
<p>下面来说一说urllib2中的两个重要概念：Openers和Handlers。<br>1.Openers：<br>当你获取一个URL你使用一个opener(一个urllib2.OpenerDirector的实例)。<br>正常情况下，我们使用默认opener：通过urlopen。<br>但你能够创建个性的openers。<br>2.Handles：<br>Openers使用处理器handlers，所有的“繁重”工作由handlers处理。<br>每个handlers知道如何通过特定协议打开URLs，或者如何处理URL打开时的各个方面。<br>例如HTTP重定向或者HTTP cookies</p>
</blockquote>
<ul>
<li><p>headers属性模拟浏览器身份</p>
<p>User-Agent : 通常会通过该值来判断是否是浏览器发出的请求<br>Content-Type : 在使用 REST 接口时，服务器会检查该值，用来确定 HTTP Body 中的内容该怎样解析。<br>application/xml ： 在 XML RPC，如 RESTful/SOAP 调用时使用<br>application/json ： 在 JSON RPC 调用时使用<br>application/x-www-form-urlencoded ： 浏览器提交 Web 表单时使用<br>在使用服务器提供的 RESTful 或 SOAP 服务时， Content-Type 设置错误会导致服务器拒绝服务<br>referer：有些网站会检测该值是否为自身，防盗链。</p>
</li>
</ul>
<p>在构建request对象时设置headers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">headers = &#123; &apos;User-Agent&apos; : &apos;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&apos;  ,</div><div class="line">                        &apos;Referer&apos;:&apos;http://www.zhihu.com/articles&apos; &#125;</div><div class="line">request = urllib2.Request(url, data, headers)  </div><div class="line">response = urllib2.urlopen(request)  </div><div class="line">page = response.read()</div></pre></td></tr></table></figure>
<p>用自建的opener()中addheaders属性加入headers参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">user_agents = [</div><div class="line">          &apos;Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11&apos;,</div><div class="line">          &apos;Opera/9.25 (Windows NT 5.1; U; en)&apos;,</div><div class="line">          &apos;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&apos;,</div><div class="line">          &apos;Mozilla/5.0 (compatible; Konqueror/3.5; Linux) KHTML/3.5.5 (like Gecko) (Kubuntu)&apos;,</div><div class="line">          &apos;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.12) Gecko/20070731 Ubuntu/dapper-security Firefox/1.5.0.12&apos;,</div><div class="line">          &apos;Lynx/2.8.5rel.1 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/1.2.9&apos;,</div><div class="line">          &quot;Mozilla/5.0 (X11; Linux i686) AppleWebKit/535.7 (KHTML, like Gecko) Ubuntu/11.04 Chromium/16.0.912.77 Chrome/16.0.912.77 Safari/535.7&quot;,</div><div class="line">          &quot;Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:10.0) Gecko/20100101 Firefox/10.0 &quot;,</div><div class="line"></div><div class="line">      ] </div><div class="line">      agent = random.choice(user_agents)</div><div class="line">      </div><div class="line">      opener.addheaders = [(&quot;User-agent&quot;,agent),(&quot;Accept&quot;,&quot;*/*&quot;),(&apos;Referer&apos;,&apos;http://www.google.com&apos;)]</div></pre></td></tr></table></figure>
<ul>
<li>Proxy代理设置</li>
</ul>
<p>在创建opner时传入Proxy handler ，urllib2.build_opener(proxy_handler)<br>或在一个opener实例中调用opener.add_handler(proxy_handler)方法传入</p>
<p>创建proxy handler对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">proxy_handler = urllib2.ProxyHandler(&#123;&quot;http&quot; : &apos;http://some-proxy.com:8080&apos;&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>超时设置timeout</li>
</ul>
<p>可以设置等待多少秒无响应即为超时，在urlopen(url,data,timeout=10)中设置</p>
<ul>
<li>http的put和delete方法</li>
</ul>
<p>http协议有6种请求数据的方法，除了最常用get和post，还有head，put，delete，options；<br>PUT：这个方法比较少见。HTML表单也不支持这个。本质上来讲， PUT和POST极为相似，都是向服务器发送数据，但它们之间有一个重要区别，PUT通常指定了资源的存放位置，而POST则没有，POST的数据存放位置由服务器自己决定。<br>DELETE：删除某一个资源。基本上这个也很少见，不过还是有一些地方比如amazon的S3云服务里面就用的这个方法来删除资源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 在创建request对象时指定put或delete方法</div><div class="line">request = urllib2.Request(url,data,headers=&#123;&#125;)</div><div class="line">request.get_method = lambda: &apos;PUT&apos; # or &apos;DELETE&apos;</div></pre></td></tr></table></figure>
<ul>
<li>使用DebugLog</li>
</ul>
<p>该功能可以将收发包的内容打印出来，不常用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">httpHandler = urllib2.HTTPHandler(debuglevel=1)</div><div class="line">httpsHandler = urllib2.HTTPSHandler(debuglevel=1)</div><div class="line">opener = urllib2.build_opener(httpHandler, httpsHandler)</div></pre></td></tr></table></figure>
<h4 id="cookie保持登陆"><a href="#cookie保持登陆" class="headerlink" title="cookie保持登陆"></a>cookie保持登陆</h4><p>在opener中绑定处理cookie对象的handler，即可捕获cookie并在后续的请求中使用。</p>
<blockquote>
<p>cookielib模块</p>
<p>cookielib模块提供可存储的cookie对象，配合urllib2使用。cookielib提供的主要对象有CookieJar、FileCookieJar、MozillaCookieJar、LWPCookieJar。</p>
</blockquote>
<ul>
<li>保存cookie到变量中，使用cookiejar()对象</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">import urllib2</div><div class="line">import cookielib</div><div class="line"></div><div class="line">cookie = cookielib.CookieJar()</div><div class="line">cookie_handler = urllib2.HTTPCookieProcessor(cookiejar=cookie)</div><div class="line">opener = urllib2.build_opener(cookie_handler)</div><div class="line">opener.open(url) </div><div class="line"># ...</div><div class="line">for item in cookie :</div><div class="line">    print item.name + item.value</div></pre></td></tr></table></figure>
<ul>
<li>保存cookie到文件中，</li>
</ul>
<p>使用FileCookieJar()对象及其子类 MozillaCookieJar和LWPCookiejar。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">import urllib2</div><div class="line">import cookielib</div><div class="line"></div><div class="line">cookie_file = &apos;cookie.txt&apos;</div><div class="line">cookie_jar=cookielib.MozillaCookieJar(filename=cookie_file)</div><div class="line">cookie_handler = urllib2.HTTPCookieProcessor(cookiejar=cookie_jar)</div><div class="line">opener = urllib2.build_opener(cookie_handler)</div><div class="line">opener.open(&apos;http:\\www.baidu.com&apos;)</div><div class="line">cookie_jar.save(ignore_discard=True, ignore_expires=True) # 即使将废弃的cookie也保存，覆盖cookie文件内容</div></pre></td></tr></table></figure>
<ul>
<li>从文件中加载cookie</li>
</ul>
<p>cookiejar对象的load方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">import urllib2</div><div class="line">import cookielib</div><div class="line"></div><div class="line">cookie_file = &apos;cookie.txt&apos;</div><div class="line">cookie_jar=cookielib.MozillaCookieJar()</div><div class="line">### load()方法</div><div class="line">cookie_jar.load(filename=cookie_file, ignore_discard=True, ignore_expires=True)</div><div class="line">cookie_handler = urllib2.HTTPCookieProcessor(cookiejar=cookie_jar)</div><div class="line">opener = urllib2.build_opener(cookie_handler)</div><div class="line">resp=opener.open(&apos;http:\\www.baidu.com&apos;)</div><div class="line">print resp.read()</div></pre></td></tr></table></figure>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><blockquote>
<p>登陆小说网站 166zw.com</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">import urllib2</div><div class="line">import urllib</div><div class="line">import cookielib</div><div class="line"></div><div class="line">########################################################################</div><div class="line">class Browser(object):</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    创建一个有cookie和headers的opener对象,带有异常处理</div><div class="line">    &quot;&quot;&quot;</div><div class="line"></div><div class="line">    #----------------------------------------------------------------------</div><div class="line">    def __init__(self):</div><div class="line">        &quot;&quot;&quot;Constructor&quot;&quot;&quot;</div><div class="line">        cookie_handler = urllib2.HTTPCookieProcessor(cookiejar=cookielib.CookieJar(</div><div class="line">                                                                                  ))</div><div class="line">        self.opener = urllib2.build_opener(cookie_handler)</div><div class="line">        self.opener.addheaders = [(&quot;User-agent&quot;,    &apos;Opera/9.25 (Windows NT 5.1; U; en)&apos;,</div><div class="line">),(&quot;Accept&quot;,&quot;*/*&quot;),(&apos;Referer&apos;,&apos;http://www.google.com&apos;)]</div><div class="line">        </div><div class="line">    </div><div class="line">    def openurl(self,url,data=None,timeout=10):</div><div class="line">        try:</div><div class="line">            response = self.opener.open(url,data,timeout)</div><div class="line">        except urllib2.URLError, e:</div><div class="line">            print e.code,&apos;\n&apos;,e.reason</div><div class="line">        return response</div><div class="line">    </div><div class="line">    </div><div class="line">postData=urllib.urlencode(&#123;&apos;username&apos;:&apos;wocaonima&apos;,\</div><div class="line">                           &apos;password&apos;:&apos;******&apos;,\</div><div class="line">                           &apos;usecookie&apos;:&apos;1&apos;,\</div><div class="line">                           &apos;submit.x&apos;:&apos;25&apos;,\</div><div class="line">                           &apos;submit.y&apos;:&apos;5&apos;,\</div><div class="line">                           &apos;action&apos;:&apos;login&apos;&#125;)</div><div class="line">loginUrl=r&apos;http://www.166zw.com/loginframe.php&apos;</div><div class="line"></div><div class="line">html=Browser().openurl(loginUrl,postData)</div><div class="line">print html.code,html.msg,html.info</div><div class="line">content= html.read()</div><div class="line">print content  ### 打印的页面含有用户名信息，表明登陆成功</div></pre></td></tr></table></figure>
<h4 id="URLError异常处理"><a href="#URLError异常处理" class="headerlink" title="URLError异常处理"></a>URLError异常处理</h4><ul>
<li>http协议状态码 </li>
</ul>
<p>服务器返回的响应请求，包含一个状态码。urllib2.HTTPError可以捕获</p>
<blockquote>
<p>100：继续  客户端应当继续发送请求。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。<br>101： 转换协议  在发送完这个响应最后的空行后，服务器将会切换到在Upgrade 消息头中定义的那些协议。只有在切换新的协议更有好处的时候才应该采取类似措施。<br>102：继续处理   由WebDAV（RFC 2518）扩展的状态码，代表处理将被继续执行。<br>200：请求成功      处理方式：获得响应的内容，进行处理<br>201：请求完成，结果是创建了新资源。新创建资源的URI可在响应的实体中得到    处理方式：爬虫中不会遇到<br>202：请求被接受，但处理尚未完成    处理方式：阻塞等待<br>204：服务器端已经实现了请求，但是没有返回新的信 息。如果客户是用户代理，则无须为此更新自身的文档视图。    处理方式：丢弃<br>300：该状态码不被HTTP/1.0的应用程序直接使用， 只是作为3XX类型回应的默认解释。存在多个可用的被请求资源。    处理方式：若程序中能够处理，则进行进一步处理，如果程序中不能处理，则丢弃<br>301：请求到的资源都会分配一个永久的URL，这样就可以在将来通过该URL来访问此资源    处理方式：重定向到分配的URL<br>302：请求到的资源在一个不同的URL处临时保存     处理方式：重定向到临时的URL<br>304：请求的资源未更新     处理方式：丢弃<br>400：非法请求     处理方式：丢弃<br>401：未授权     处理方式：丢弃<br>403：禁止     处理方式：丢弃<br>404：没有找到     处理方式：丢弃<br>500：服务器内部错误  服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器端的源代码出现错误时出现。<br>501：服务器无法识别  服务器不支持当前请求所需要的某个功能。当服务器无法识别请求的方法，并且无法支持其对任何资源的请求。<br>502：错误网关  作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。<br>503：服务出错   由于临时的服务器维护或者过载，服务器当前无法处理请求。这个状况是临时的，并且将在一段时间以后恢复。</p>
</blockquote>
<ul>
<li>URLError </li>
</ul>
<p>HTTPError是URLError的子类,所以try… except…时应先捕获子类，子类捕获不到再捕获父类错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">import urllib2</div><div class="line"></div><div class="line">req = urllib2.Request(&apos;http://blog.csdn.net/cqcre&apos;)</div><div class="line">try:</div><div class="line">    urllib2.urlopen(req)</div><div class="line">except urllib2.HTTPError, e:</div><div class="line">    print e.code</div><div class="line">except urllib2.URLError, e:</div><div class="line">    print e.reason</div><div class="line">else:</div><div class="line">    print &quot;OK&quot;</div></pre></td></tr></table></figure>
<p>直接捕获一个URLError，如果含有code和reason属性，则说明是一个HTTPError。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">import urllib2</div><div class="line"></div><div class="line">req = urllib2.Request(&apos;http://blog.csdn.net/cqcre&apos;)</div><div class="line">try:</div><div class="line">    urllib2.urlopen(req)</div><div class="line">except urllib2.URLError, e:</div><div class="line">    if hasattr(e,&quot;code&quot;):</div><div class="line">        print e.code,e.reason </div><div class="line">    else:</div><div class="line">        print e</div><div class="line">else: </div><div class="line">    print ok</div></pre></td></tr></table></figure>
<hr>
<h3 id="正则表达式-和-bs4"><a href="#正则表达式-和-bs4" class="headerlink" title="正则表达式 和 bs4"></a>正则表达式 和 bs4</h3><h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><blockquote>
<p>正则表达式用来匹配符合特定规则的字符串，类似于数学表达式是一种逻辑公式，实现对字符串的过滤匹配。</p>
</blockquote>
<ul>
<li>正则表达式的语法规则</li>
</ul>
<p><img src="http://ww2.sinaimg.cn/large/af9df239jw1f76t5gaxbaj20m71brx03.jpg" alt=""></p>
<ul>
<li>贪婪模式和转义字符</li>
</ul>
<p>python默认使用贪婪模式匹配查找字符串，即总是尝试匹配尽可能多的字符，非贪婪模式则相反。举例：模式ab<em> 在<code>abbbc</code>字符串中将匹配到3个b，即<code>abbb</code>;非贪婪模式ab</em>? 在<code>abbbc</code>字符串中将匹配到0个b，即<code>a</code>;</p>
<p>转义字符为<code>\</code>，很多编程语言也用<code>\</code>做转义字符，那么编程语言里的正则表达式想要匹配“\”就得使用4个‘\’,即“\\”。先在编程语言环境中转义得到“\”,然后提供给正则表达式。<br>好在python有原生字符串的表示方法，即不转义任何’\’,而将其作为字符’\’,比如 print r’\s\%\‘ 执行后得到的结果就是 \s\%\ 。</p>
<ul>
<li>re模块</li>
</ul>
<blockquote>
<p>re模块提供正则表达式引擎</p>
</blockquote>
<p>pattern 是re 匹配模式的对象，由正则表达式字符串预编译得到。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import re</div><div class="line">pattern = re.compile(r&apos;\d&apos;)</div></pre></td></tr></table></figure>
<p>re主要的方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#返回pattern对象,该对象包含match，findall等方法</div><div class="line">p = re.compile(string[,flag])  </div><div class="line">#以下为匹配所用函数，也可传入pattern字符串，re会先执行compile编译正则表达式字符串生成pattern对象</div><div class="line">re.match(pattern, string[, flags])</div><div class="line">re.search(pattern, string[, flags])</div><div class="line">re.split(pattern, string[, maxsplit])</div><div class="line">re.findall(pattern, string[, flags])</div><div class="line">re.finditer(pattern, string[, flags])</div><div class="line">re.sub(pattern, repl, string[, count])</div><div class="line">re.subn(pattern, repl, string[, count])</div></pre></td></tr></table></figure>
<p>flag参数可选值如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">• re.I(全拼：IGNORECASE): 忽略大小写（括号内是完整写法，下同）</div><div class="line">• re.M(全拼：MULTILINE): 多行模式，改变&apos;^&apos;和&apos;$&apos;的行为（参见上图）</div><div class="line">• re.S(全拼：DOTALL): 点任意匹配模式，改变&apos;.&apos;的行为</div><div class="line">• re.L(全拼：LOCALE): 使预定字符类 \w \W \b \B \s \S 取决于当前区域设定</div><div class="line">• re.U(全拼：UNICODE): 使预定字符类 \w \W \b \B \s \S \d \D 取决于unicode定义的字符属性</div><div class="line">• re.X(全拼：VERBOSE): 详细模式。这个模式下正则表达式可以是多行，忽略空白字符，并可以加入注释。</div></pre></td></tr></table></figure>
<ul>
<li><p>re方法</p>
<ul>
<li><p>re.match(pattern,string,flag)<br>match返回第一次匹配成功的结果（match对象）或None。注意match是从字符串开头的第一个字符开始匹配。<code>hello</code>模式match 字符串<code>say hello</code>就会失败返回None。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> import re</div><div class="line"># 匹配如下内容：单词+空格+单词+任意字符</div><div class="line">m = re.match(r&apos;(\w+) (\w+)(?P&lt;sign&gt;.*)&apos;, &apos;hello world!&apos;)</div><div class="line">print &quot;m.string:&quot;, m.string</div><div class="line">print &quot;m.re:&quot;, m.re</div><div class="line">print &quot;m.pos:&quot;, m.pos</div><div class="line">print &quot;m.endpos:&quot;, m.endpos</div><div class="line">print &quot;m.lastindex:&quot;, m.lastindex</div><div class="line">print &quot;m.lastgroup:&quot;, m.lastgroup</div><div class="line">print &quot;m.group():&quot;, m.group() # 默认返回group(0),即整个匹配结果，group(n)可以输出第n个元组匹配的结果。</div><div class="line">print &quot;m.group(1,2):&quot;, m.group(1, 2)</div><div class="line">print &quot;m.groups():&quot;, m.groups()</div><div class="line">print &quot;m.groupdict():&quot;, m.groupdict()</div><div class="line">print &quot;m.start(2):&quot;, m.start(2)</div><div class="line">print &quot;m.end(2):&quot;, m.end(2)</div><div class="line">print &quot;m.span(2):&quot;, m.span(2)</div><div class="line">print r&quot;m.expand(r&apos;\g \g\g&apos;):&quot;, m.expand(r&apos;\2 \1\3&apos;)</div></pre></td></tr></table></figure>
</li>
<li><p>re.search(pattern, string[, flags])<br>search()同match()方法相似，区别是match()仅从字符串的开头匹配，如果0位置失败，则匹配以失败结束。search同match有相同的属性和方法。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">    #导入re模块</div><div class="line">  import re</div><div class="line"># 将正则表达式编译成Pattern对象</div><div class="line">pattern = re.compile(r&apos;world&apos;)</div><div class="line"># 使用search()查找匹配的子串，不存在能匹配的子串时将返回None</div><div class="line"># 这个例子中使用match()无法成功匹配</div><div class="line">res = re.search(pattern,&apos;hello world!&apos;)</div><div class="line">if res:</div><div class="line">    # 使用Match获得分组信息</div><div class="line">    print res.group()</div><div class="line">### 输出 ###</div><div class="line"># world</div></pre></td></tr></table></figure>
</li>
<li><p>re.split(pattern, string[, maxsplit])</p>
<p>  按照能够匹配的子串将string分割后返回列表。maxsplit用于指定最大分割次数，不指定将全部分割。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  import re</div><div class="line">  pattern = re.compile(r&apos;\d+&apos;)</div><div class="line">  print re.split(pattern,&apos;one1two2three3four4&apos;)</div><div class="line">  </div><div class="line">### 输出 ###</div><div class="line"># [&apos;one&apos;, &apos;two&apos;, &apos;three&apos;, &apos;four&apos;, &apos;&apos;]</div></pre></td></tr></table></figure>
<ul>
<li><p>re.findall(pattern, string[, flags])</p>
<p>搜索string，以列表形式返回全部能匹配的子串</p>
</li>
<li><p>re.finditer(pattern, string[, flags])</p>
<p>搜索string，返回一个顺序访问每一个匹配结果（Match对象）的迭代器.迭代器使用for进行遍历。</p>
</li>
<li>re.sub(pattern, repl, string[, count])</li>
</ul>
<p>使用repl替换string中每一个匹配的子串后返回替换后的字符串。<br>当repl是一个字符串时，可以使用\id或\g、\g引用分组，但不能使用编号0。<br>当repl是一个方法时，这个方法应当只接受一个参数（Match对象），并返回一个字符串用于替换（返回的字符串中不能再引用分组）。<br>count用于指定最多替换次数，不指定时全部替换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">import re</div><div class="line"></div><div class="line">pattern = re.compile(r&apos;(\w+) (\w+)&apos;)</div><div class="line">s = &apos;i say, hello world!&apos;</div><div class="line"></div><div class="line">print re.sub(pattern,r&apos;\2 \1&apos;, s)</div><div class="line"></div><div class="line">def func(m):</div><div class="line">    return m.group(1).title() + &apos; &apos; + m.group(2).title()</div><div class="line"></div><div class="line">print re.sub(pattern,func, s)</div><div class="line"></div><div class="line">### output ###</div><div class="line"># say i, world hello!</div><div class="line"># I Say, Hello World!</div></pre></td></tr></table></figure>
</li>
<li><p>re.subn(pattern, repl, string[, count])</p>
<p>  返回 (sub(repl, string[, count]), 替换次数)。</p>
</li>
<li><p>使用pattern对象调用上述方法则不必传入pattern对象</p>
</li>
</ul>
<h4 id="常用匹配"><a href="#常用匹配" class="headerlink" title="常用匹配"></a>常用匹配</h4><ul>
<li>ip</li>
<li>文件后缀</li>
</ul>
<p><code>r&#39;http://img\.tupianzj\.com/uploads/allimg/\d+/.+\.(?:gif|jpg|png|bmp)&#39;</code></p>
<h4 id="BeautifulSoup"><a href="#BeautifulSoup" class="headerlink" title="BeautifulSoup"></a>BeautifulSoup</h4><blockquote>
<p>BeautifulSoup是python的一个第三方库，用于解析网页并从中提取数据。</p>
</blockquote>
<ul>
<li>安装 </li>
</ul>
<p><code>pip install beautifulsoup4</code>,或去官网下载安装包。<br>  BeautifulSoup使用Python标准库中默认的HTML解析器，想要使用其他可选的第三方html解析器需要提前安装好。 lxml或html5lib。lxml解析器更强大速度更快。html5lib是纯python实现的，解析方式与浏览器相同。</p>
<p><code>pip install lxml</code>  和  <code>pip install html5lib</code></p>
<p>windows下直接pip安装lxml失败，可以先<code>pip install wheel</code> ,然后去<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml" target="_blank" rel="external">Python Extension Packages for Windows - Christoph Gohlke</a>上下载对应系统的安装包，然后<code>pip install c:\lxml-3.6.4-cp27-cp27m-win_amd64.whl</code><br>其他pip无法直接安装的模块也可用这种方法。</p>
<ul>
<li>官方文档</li>
</ul>
<p><a href="http://beautifulsoup.readthedocs.io/zh_CN/latest/" target="_blank" rel="external">Beautiful Soup 4.4.0 文档 — beautifulsoup 4.4.0 文档</a></p>
<ul>
<li><p>使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">from bs4 import BeautifulSoup</div><div class="line">import urllib2</div><div class="line"></div><div class="line">URL = r&quot;http://www.baidu.com&quot;</div><div class="line">content = urllib2.urlopen(URL).read()</div><div class="line">bsobj = BeautifulSoup(content) #传入html格式的字符串</div><div class="line">print bsobj.prettify() #打印出html文档树，格式化输出</div></pre></td></tr></table></figure>
<p>bs将html文档转换为树形结构，每个节点都是一个对象，对象分为4种：Tag，NavigableString，BeautifulSoup，Comment。</p>
<ul>
<li><p>Tag</p>
<p> 即HTML中的标签，由<code>&lt;&gt;</code> <code>&lt;/&gt;</code>闭合。比如<title> News Today</title><br> 获取标签方法如下，找不到返回None，这种方法只能查找符合条件的第一个标签。tag常用的属性有name，attrs，string。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">print bsobj.title</div><div class="line"># &lt;title&gt;百度一下，你就知道&lt;/title&gt;</div><div class="line">print bsobj.title.string</div><div class="line">#  百度一下，你就知道</div><div class="line">print bsobj.div.attrs</div><div class="line"># &#123;&apos;id&apos;: &apos;wrapper&apos;&#125;  输出的是标签的属性</div><div class="line">print bsobj.div.name</div><div class="line"># div  标签的名字为对象本身的名字，bsobj对象的名字为`[document]`</div><div class="line">#获取某个属性的值</div><div class="line">print bsobj.div[&apos;id&apos;]</div><div class="line">wrapper</div><div class="line">print bsobj.div.get(&apos;id&apos;)</div><div class="line">wrapper</div></pre></td></tr></table></figure>
</li>
<li><p>NavgableString</p>
<p> 可以遍历的字符串，即标签闭合的内容：<code>print bsobj.title.string  #输出  百度一下，你就知道</code></p>
</li>
<li><p>BeautifulSoup</p>
<p>BeautifulSoup对象表示一个文档的全部内容，也可以当做tag对象，只不过是包含很多子tag的特殊的tag</p>
</li>
<li><p>Comment</p>
<p> Comment 对象是一个特殊类型的 NavigableString 对象，但是使用ob.string输出的内容仍然不包括注释符号。<br>  有必要时可进行类型判断</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> if type(soup.a.string)==bs4.element.Comment:</div><div class="line">print soup.a.string</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>遍历文档树</p>
<ul>
<li><p>tag.contens 属性</p>
<p>bsobj.tag.contents 可以将tag的子节点以列表的形式输出。</p>
</li>
<li><p>tag.children 属性</p>
<p>bsobj.tag.children 是一个子节点的list生成器，可以用for循环遍历</p>
</li>
<li><p>tag.descendants 属性</p>
<p>bsobj.tag.descendants 是tag的子孙节点的list生成器，用for遍历。而contents和children只包含孩子节点（一级子节点），不包含孩子的孩子及后续孙子节点。</p>
</li>
<li><p>tag.string 属性，节点内容</p>
<p>如果tag只含有唯一的一个子tag，那么tag.string输出的是子tag的内容，不含子tag，则直接输出tag的内容；如果有多个子tag，则输出none。</p>
</li>
<li><p>tag.strings 和 tag.stripped_strings 获取多个内容</p>
<p>都需要用for循环遍历，.stripped_strings去除了多余空白内容。</p>
</li>
<li><p>tag.parent 属性 父节点</p>
</li>
<li><p>tag.parents 属性 全部父辈节点</p>
<p>通过递归得到tag全部的父辈节点，用for循环遍历</p>
</li>
<li><p>tag.next_sibling 和 tag.previous_sibling 兄弟节点</p>
<p>获取与tag同一级的节点，.next_sibling 属性获取了该节点的下一个兄弟节点，.previous_sibling 则与之相反，如果节点不存在，则返回 None<br>注意：实际文档中的tag的 .next_sibling 和 .previous_sibling 属性通常是字符串或空白，因为空白或者换行也可以被视作一个节点，所以得到的结果可能是空白或者换行</p>
</li>
<li>.next_siblings  .previous_siblings 属性 全部兄弟节点</li>
<li><p>.next_element  .previous_element 属性 </p>
<p>tag节点的前后节点，与兄弟节点不同，前后节点没有层级关系，可以是父子也可以是兄弟节点。</p>
</li>
<li>.next_elements  .previous_elements 属性</li>
</ul>
</li>
<li><p>搜索文档树</p>
<ul>
<li><p>bsobj.find_all(name=None, attrs={}, recursive=True, text=None, limit=None)<br>搜索当前tag的所有子tag，返回符合条件的结果  </p>
<ul>
<li><p>name 参数<br> 查找所有名字满足name条件的tag。<br> 1&gt;如果传入字符串，则搜索完全匹配该字符串的tag : <name></name>标签;<br> 2&gt; 传正则表达式，搜索名字匹配正则的tag标签<br> 3&gt; 传入name列表，返回所有与列表元素匹配的tag<br> 4&gt; 传True，返回全部的任意tag，除字符串节点。<br> 5&gt; 传方法，该方法只接收一个参数，根据判断条件返回True 或False。find_all()返回的是满足True的全部节点</p>
</li>
<li><p>attrs 和 keyword 参数</p>
<p>attrs={‘id’:’123’,’color’:’red’},attrs接收一个字典，用来搜索含有指定属性的tag。<br>也可以指定关键字参数，如 id=’today’,class_=’no<em>style’,注意class是python保留字，所以bs使用class</em>来做区别。注意 html5中的类似 <code>data-*</code>的参数不能用作关键字搜索，会报错。</p>
</li>
<li><p>text参数</p>
<p>可以匹配文档中的字符串内容，与name参数的可选值一样，接收 字符串，正则表达式，列表，True</p>
</li>
<li><p>limit参数</p>
<p>limit = n ，限制返回的数量为n，即找到n个节点就停止。</p>
</li>
<li><p>recursive参数</p>
<p>递归参数默认为true，即搜索子孙节点。如果只搜索子节点怎改为false。</p>
</li>
</ul>
</li>
</ul>
</li>
<li>find( name , attrs , recursive , text , **kwargs )<br>它与 find_all() 方法唯一的区别是 find_all() 方法的返回结果是值包含一个元素的列表,而 find() 方法直接返回结果</li>
<li>find_parents() 和 find_parent()<br>find_all() 和 find() 只搜索当前节点的所有子节点,孙子节点等. find_parents() 和 find_parent() 用来搜索当前节点的父辈节点,搜索方法与普通tag的搜索方法相同,搜索文档搜索文档包含的内容</li>
<li>find_next_siblings()  find_next_sibling()<br>迭代对象为tag.next_siblings ，对tag 的所有后面解析的兄弟 tag 节点进行迭代, find_next_siblings() 方法返回所有符合条件的后面的兄弟节点,find_next_sibling() 只返回符合条件的后面的第一个tag节点</li>
<li>find_previous_siblings()   和  find_previous_sibling()<br>迭代对象为.previous_siblings ，对当前 tag 的前面解析的兄弟 tag 节点进行迭代, find_previous_siblings() 方法返回所有符合条件的前面的兄弟节点, find_previous_sibling() 方法返回第一个符合条件的前面的兄弟节点</li>
<li>find_all_next()  find_next()<br>迭代对象为tag.next_elements，find_all_next() 方法返回所有符合条件的节点, find_next() 方法返回第一个符合条件的节点</li>
<li>find_all_previous() 和 find_previous()<br>迭代对象为.previous_elements,find_all_previous() 方法返回所有符合条件的节点, find_previous()方法返回第一个符合条件的节点</li>
</ul>
<h3 id="Requests库的用法"><a href="#Requests库的用法" class="headerlink" title="Requests库的用法"></a>Requests库的用法</h3><blockquote>
<p>Requests是第三方库，比urllib库更高级、抽象。也就是说使用更方便。</p>
</blockquote>
<p><a href="http://docs.python-requests.org/en/master/" target="_blank" rel="external">文档 Requests: HTTP for Humans — Requests 2.11.1 documentation</a></p>
<p>安装 <code>pip install requests</code></p>
<ul>
<li><p>初次相见<br><code>html= requests.get(url)</code>,返回的是<class 'requests.models.response'="">对象，具有以下属性或方法：’apparent_encoding’, ‘close’, ‘connection’, ‘content’, ‘cookies’, ‘elapsed’, ‘encoding’, ‘headers’, ‘history’, ‘is_permanent_redirect’, ‘is_redirect’, ‘iter_content’, ‘iter_lines’,<br>‘json()’：解析json格式内容,<br>‘links’, ‘ok’, ‘raise_for_status’,<br>‘raw’：获得原始套接字,要在初始的请求中设置stream=True<br>‘reason’, ‘request’, ‘status_code’ ：http响应状态码,<br>‘text’:直接输出内容,<br>‘url’</class></p>
</li>
<li><p>基本http请求</p>
<blockquote>
<p>requests实现了http的6种请求，get、post、delete、put、options、head。</p>
</blockquote>
</li>
<li><p>GET请求方式<br><code>requests.get(url, params=None)</code>,参数传入字典，比如{‘k1’:’v1’ , ‘k2’:’v2’}，则请求url自动编码为<code>url?k1=v1&amp;k2=v2</code><br>在请求中添加headers，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">import requests</div><div class="line"></div><div class="line">payload = &#123;&apos;key1&apos;: &apos;value1&apos;, &apos;key2&apos;: &apos;value2&apos;&#125;</div><div class="line">headers = &#123;&apos;content-type&apos;: &apos;application/json&apos;&#125;</div><div class="line">r = requests.get(&quot;http://httpbin.org/get&quot;, params=payload, headers=headers)</div><div class="line">print r.url</div></pre></td></tr></table></figure>
</li>
<li><p>post请求</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line">post_data =&#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125; </div><div class="line">res = requests.post(url, data=post_data, json=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 如果提交的信息不是表单形式，而是json格式的数据，可用json.dumps()把表单数据序列化,或使用json参数</span></div><div class="line">res = requests.post(url, data=json.dumps(post_data), json=<span class="keyword">None</span>)</div><div class="line">res = requests.post(url, data=<span class="keyword">None</span>, json=post_data)</div><div class="line"><span class="comment"># 以上2者等效</span></div><div class="line"><span class="comment"># 支持流式上传数据，只需传入一个file-like对象,不用file.read()加载内容至内存</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'test.file'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f :</div><div class="line">    res = requests.post(url, data=f)</div></pre></td></tr></table></figure>
</li>
<li><p>Cookies</p>
</li>
</ul>
<p>如果服务器返回的响应包含cookie，则我们得到的response对象就会保存该cookie，可以利用.cookies属性查看。<br>使用cookie发送请求时只需在get/post方法中指定cookies参数<br>要想使用cookie保持登陆，则需要一个session会话对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看cookies</span></div><div class="line"><span class="keyword">import</span> requests</div><div class="line">url1 = <span class="string">'http://xxx.com'</span></div><div class="line">r = requests.get(url1)</div><div class="line"><span class="keyword">print</span> r.cookies</div><div class="line"><span class="comment"># 构造cookies并用来发送请求</span></div><div class="line">url2 = <span class="string">'http://ooo.com'</span></div><div class="line">cookies = &#123;<span class="string">'id'</span>:<span class="string">'1234'</span>&#125;</div><div class="line">r = requests.get(url2，cookies=cookies)</div></pre></td></tr></table></figure>
<ul>
<li><p>超时设置 timeout<br>在get/post方法中传入timeout参数，仅对连接建立有效，与返回response全部数据的时间无关。</p>
</li>
<li><p>会话对象 session</p>
</li>
</ul>
<p>每次直接调用requests.get/post方法都相当与建立了一个新的请求会话，相当于用不同的浏览器发起请求。因而无法使用cookie保持登陆状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">s = requests.session()</div><div class="line">s.headers.update(&#123;(&quot;User-agent&quot;,&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.8.1.11)  Gecko/20071127 Firefox/2.0.0.11&quot;),(&quot;Accept&quot;,&quot;*/*&quot;),(&apos;Referer&apos;,&apos;http://www.google.com &apos;)&#125;) </div><div class="line"># 此处设置的headers是全局变量，post/get方法传入的headers参数的同名变量会覆盖此处headers的变量，不使用某个参数可将其值设为None。</div><div class="line"># 不同名的参数会一块加入到请求的headers中生效.</div><div class="line">res = s.get(url)</div><div class="line"># 通过会话发起请求</div></pre></td></tr></table></figure>
<ul>
<li>SSL证书验证<br>Requests可以为HTTPS请求验证SSL证书，就像web浏览器一样。要想检查某个主机的SSL证书，你可以在get/post方法中使用 verify 参数，默认为True，是检查的。<br>如直接requests.get(‘<a href="https://www.12306.cn&#39;),就会出现证书无效的错误：requests.exceptions.SSLError" target="_blank" rel="external">https://www.12306.cn&#39;),就会出现证书无效的错误：requests.exceptions.SSLError</a>: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:590)。<pre><code>使用requests.get(url=&apos;https://www.12306.cn&apos;,verify=False)取消证书检查。
</code></pre></li>
<li><p>代理<br>在post/get方法中传入参数proxies：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">proxies = &#123;</div><div class="line">  &quot;https&quot;: &quot;http://41.118.132.69:4433&quot;</div><div class="line">&#125;</div><div class="line">r = requests.post(&quot;http://httpbin.org/post&quot;, proxies=proxies)</div></pre></td></tr></table></figure>
<p>也可以设置环境变量HTTP_PROXY和HTTPS_PROXY来配置代理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export HTTP_PROXY=&quot;http://10.10.1.10:3128&quot;</div><div class="line">export HTTPS_PROXY=&quot;http://10.10.1.10:1080&quot;</div></pre></td></tr></table></figure>
</li>
<li><p><a href="http://docs.python-requests.org/en/master/api/" target="_blank" rel="external">参考：官方API文档</a></p>
</li>
</ul>
<h3 id="xpath语法与lxml库"><a href="#xpath语法与lxml库" class="headerlink" title="xpath语法与lxml库"></a>xpath语法与lxml库</h3><blockquote>
<p>lxml解析库使用xpath语法，beautifulSoup的内部实现是RE<br><a href="http://www.w3school.com.cn/xpath/index.asp" target="_blank" rel="external">xpath语法参考</a><br><a href="http://lxml.de/index.html" target="_blank" rel="external">lxml官方文档 - Processing XML and HTML with Python</a></p>
</blockquote>
<h4 id="xpath语法"><a href="#xpath语法" class="headerlink" title="xpath语法"></a>xpath语法</h4><blockquote>
<p>XPath 是一门在 XML 文档中查找信息的语言。XPath 可用来在 XML 文档中对元素和属性进行遍历。XPath 是 W3C XSLT 标准的主要元素，并且 XQuery 和 XPointer 都构建于 XPath 表达之上。</p>
</blockquote>
<p>xpath使用路径表达在xml中选取节点。<br>节点的逻辑关系有：父节点Parent、先辈节点Ancestor、子节点Children、后代节点Descendant、兄弟/同胞节点sibling。</p>
<p>路径表达式：<code>nodename</code>: 选择nodename节点的所有子节点,<code>/</code>:从根路径选取,绝对路径，<code>//</code>:从当前路径下选取全部,不考虑位置，相对路径，<code>.</code>:选取当前节点,<code>..</code>:选取当前节点的父节点,<code>@</code>:选取属性. </p>
<p>谓语：用来查找某个特定的节点或者包含某个特定的值的节点。谓语嵌在方括号[]中。</p>
<p>| 路径表达式 |    结果   |<br>| /bookstore/book[1] | 选取属于 bookstore 子元素的第一个 book 元素。 |<br>| /bookstore/book[last()] | 选取属于 bookstore 子元素的最后一个 book 元素。 |<br>| /bookstore/book[last()-1] | 选取属于 bookstore 子元素的倒数第二个 book 元素。 |<br>| /bookstore/book[position()<3] |="" 选取最前面的两个属于="" bookstore="" 元素的子元素的="" book="" 元素。="" title[@lang]="" 选取所有拥有名为="" lang="" 的属性的="" title="" title[@lang="’eng’]" 选取所有="" 元素，且这些元素拥有值为="" eng="" 的="" 属性。="" book[price="">35.00] | 选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。 |<br>| /bookstore/book[price&gt;35.00]/title | 选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。 |</3]></p>
<p>选取未知节点： <code>*</code>:匹配任何节点; <code>@*</code>:匹配任何属性的节点; <code>node()</code>:匹配任何类型的节点;</p>
<p>选取多个路径：<code>|</code>运算符，<code>//book/title | //book/price</code></p>
<p>xpath表达式运算符<br><code>|</code>:找到满足2个路径表达式之一的节点集合；<br><code>+</code>:加法<br><code>-</code>:减法<br><code>*</code>:乘法<br><code>div</code>:除法，取整 ; <code>mod</code>:取余数<br><code>=</code>:等于，比较，相等返回true，否则返回false<br><code>！=</code>:不等于，比较<br><code>&lt;</code>:小于 ； <code>&lt;=</code>:小于或等于<br><code>&gt;</code>:大于 ； <code>&gt;=</code>:大于或等于<br><code>or</code>: 或，连接2个布尔表达式，有一个为真返回true<br><code>and</code>: 与，都为真才返回true</p>
<h4 id="lxml用法"><a href="#lxml用法" class="headerlink" title="lxml用法"></a>lxml用法</h4><h3 id="PhantomJS的用法"><a href="#PhantomJS的用法" class="headerlink" title="PhantomJS的用法"></a>PhantomJS的用法</h3><h3 id="Selenium的用法"><a href="#Selenium的用法" class="headerlink" title="Selenium的用法"></a>Selenium的用法</h3><h3 id="PyQuery的用法"><a href="#PyQuery的用法" class="headerlink" title="PyQuery的用法"></a>PyQuery的用法</h3><hr>
<h3 id="PySpider框架"><a href="#PySpider框架" class="headerlink" title="PySpider框架"></a>PySpider框架</h3>
      
    </div>
    <footer>
      
        
		<!--  livere评论支持 -->
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/page/4/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/6/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  
<div>
<a href="javascript:;" class="popup-trigger">      
      <i class="menu-item-icon fa fa-search fa-fw"></i>        
   搜索
</a>
</div>


<div class="site-search">
<div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>
</div>

<script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
     
  var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';
                var str1=str                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>';
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
					else { isMatch=false; } //更新此处
					
					//更新此处
					
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ "> " + data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 20;
                            var end = first_occur + 30;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
							//console.log(match_content)
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                    }
                })
                //修改
				if (str1==str){
					str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';
					}
				
				$resultContent.innerHTML = str;
            })
        }
    })
}
    // search function;
 </script>
<script>

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
	  proceedsearch();
	  //添加的
	  document.getElementById("local-search-result").innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>';
     
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>
  
<script type="text/javascript">      
     var search_path = "search.xml";
     if (search_path.length == 0) {
     	search_path = "search.xml";
     }
     var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
</script>





  
<div class="widget tag">
  <h3 class="title" id="categories">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">43</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/django/">django</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/git/">git</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/latex/">latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/linux/">linux</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/mongodb/">mongodb</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/numpy/">numpy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/pandas/">pandas</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/python/">python</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/python-爬虫/">python 爬虫</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/redis/">redis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/scrapy/">scrapy</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/其他/">其他</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/生活/游戏/">游戏</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/读书/">读书</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/科研/">科研</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/资源/">资源</a><span class="category-list-count">3</span></li></ul> 
</div>
 

  <div class="widget tag">
<h3 class="title">简介</h3>
<ul class="entry">
<li>博主：帅羊羊</li>
<li>现状：武大CS在读研究生</li>
<li>Theme: <a href="https://github.com/shuaiyy/lightum">Lightum</a>
<!-- <li>想交友的朋友请<a href="http://zipperary.com/about">联系我</a>！</li> -->
<li>QQ 号：2Ol896963</li>
<li>博客: 记录个人生活学习的点滴</li>
<!-- <font color="red">Hexo 交流群：287306637</font> -->
</ul>
</div>



  <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=0&uid=2946363961&verifier=371067b2&dpc=1"></iframe>

  <div class="widget tag">
<h3 class="title">打赏</h3>
<ul class="entry">
<li>支付宝扫一扫，捐助支持，谢谢！</li>
<li><a href="http://o8i01ajlj.bkt.clouddn.com/blog/171004/LikDAfKDg0.png" title="" class="fancybox" rel="gallery3"><img width="100%" src="http://o8i01ajlj.bkt.clouddn.com/blog/171004/LikDAfKDg0.png"></a></li>
</ul>
</div>

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Django/">Django</a><small>4</small></li>
  
    <li><a href="/tags/Enjoy/">Enjoy</a><small>2</small></li>
  
    <li><a href="/tags/Exam/">Exam</a><small>1</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>3</small></li>
  
    <li><a href="/tags/Html/">Html</a><small>1</small></li>
  
    <li><a href="/tags/Ipython/">Ipython</a><small>1</small></li>
  
    <li><a href="/tags/LaTeX/">LaTeX</a><small>2</small></li>
  
    <li><a href="/tags/LaTeX-Mac/">LaTeX Mac</a><small>1</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>9</small></li>
  
    <li><a href="/tags/Mac/">Mac</a><small>1</small></li>
  
    <li><a href="/tags/MachineLearning/">MachineLearning</a><small>1</small></li>
  
    <li><a href="/tags/Markdown/">Markdown</a><small>1</small></li>
  
    <li><a href="/tags/Math/">Math</a><small>2</small></li>
  
    <li><a href="/tags/Math-Optimization/">Math Optimization</a><small>3</small></li>
  
    <li><a href="/tags/Math-Optimization-MachineLearning/">Math Optimization MachineLearning</a><small>1</small></li>
  
    <li><a href="/tags/Matlab/">Matlab</a><small>1</small></li>
  
    <li><a href="/tags/Matplotlib/">Matplotlib</a><small>1</small></li>
  
    <li><a href="/tags/Mongodb-数据库/">Mongodb 数据库</a><small>1</small></li>
  
    <li><a href="/tags/Notebook/">Notebook</a><small>1</small></li>
  
    <li><a href="/tags/Numpy/">Numpy</a><small>2</small></li>
  
    <li><a href="/tags/Optimization/">Optimization</a><small>4</small></li>
  
    <li><a href="/tags/Pandas/">Pandas</a><small>1</small></li>
  
    <li><a href="/tags/Phantomjs/">Phantomjs</a><small>1</small></li>
  
    <li><a href="/tags/Pip/">Pip</a><small>1</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>18</small></li>
  
    <li><a href="/tags/Redis/">Redis</a><small>3</small></li>
  
    <li><a href="/tags/SNMP/">SNMP</a><small>1</small></li>
  
    <li><a href="/tags/Scrapy/">Scrapy</a><small>4</small></li>
  
    <li><a href="/tags/Selenium/">Selenium</a><small>1</small></li>
  
    <li><a href="/tags/Service/">Service</a><small>1</small></li>
  
    <li><a href="/tags/Zabbix/">Zabbix</a><small>1</small></li>
  
    <li><a href="/tags/数据库/">数据库</a><small>1</small></li>
  
    <li><a href="/tags/明信片/">明信片</a><small>2</small></li>
  
    <li><a href="/tags/爬虫/">爬虫</a><small>5</small></li>
  
    <li><a href="/tags/随感/">随感</a><small>1</small></li>
  
  </ul>
</div>


  <div class="widget tag">
  <h3 class="title">日历云</h3>
  <div id="calendar"></div>
</div>

  
  <div class="widget tag">
    <h3 class="title">归档</h3>
	<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">2017年09月</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">2017年05月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">2017年04月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">2017年03月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">2017年02月</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">2016年12月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">2016年11月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">2016年10月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">2016年09月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">2016年08月</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">2016年07月</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">2016年05月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">2016年01月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">2015年01月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">2014年12月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">2014年09月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">2014年08月</a><span class="archive-list-count">1</span></li></ul>
  </div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><section>
<div class="copyright">
		
		  
		  &copy;2014&mdash; <span itemprop="copyrightYear">2017</span>
		  
  <span class="with-love">
    <i class="fa fa-heart" style="color:red"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shuaiyy</span>
</div>
主题 - <a href="https://github.com/shuaiyy/lightum">Lightum</a>, Improved from <a href="https://github.com/hexojs/hexo-theme-light">Light</a>, by <a href="/">shuaiyy</a> 
<p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>
</section>
<div class="clearfix"></div>
</footer>
  <script src="//libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!-- add calendar widget -->

  <script src="/js/calendar.js"></script>
  <script src="/js/languages.js"></script>
  <script type="text/javascript">
    $(function() {
    
      $('#calendar').aCalendar('zh-CN',{single:true, root:'calendar/'});
    
    });
  </script>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body>
</html>


<a href="https://github.com/shuaiyy" target="_blank"><img style="position: absolute; top: 0; left: 0; border: 0;" src="/imgs/forkme_left_green_007200.png" alt="Fork me on GitHub"></a>
